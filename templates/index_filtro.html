<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MIR4 Market Hunter - Pro</title>
    <link rel="icon" type="image/png" href="https://cdn-icons-png.flaticon.com/512/3524/3524659.png">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ============ NOVO LAYOUT COMPACTO ============ */
        .filtros-topo {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            padding: 15px;
            background: #1a202c;
            border-radius: 10px;
            margin-bottom: 15px;
            align-items: flex-end; /* Alinhar elementos pela base */
            justify-content: center;
        }
        
        /* Mini Dropdowns inline */
        .mini-dropdown {
            position: relative;
            min-width: 110px;
            display: flex;
            flex-direction: column;
            gap: 3px;
            align-self: flex-end; /* Alinhar pela base com outros bot√µes */
        }
        
        .mini-dropdown-btn {
            width: 100%;
            padding: 8px 12px;
            background: #2d3748;
            border: 1px solid #4a5568;
            border-radius: 6px;
            color: #e2e8f0;
            font-size: 0.8rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 8px;
            transition: all 0.2s ease;
            height: 36px; /* Altura fixa igual aos outros bot√µes */
            box-sizing: border-box;
        }
        
        .mini-dropdown-btn:hover {
            border-color: #667eea;
            background: #3d4a5c;
        }
        
        .mini-dropdown-btn.active {
            border-color: #48bb78;
            background: #2d4a3d;
        }
        
        .mini-dropdown-count {
            background: #4a5568;
            color: #a0aec0;
            padding: 1px 6px;
            border-radius: 10px;
            font-size: 0.7rem;
        }
        
        .mini-dropdown-count.has-value {
            background: #48bb78;
            color: white;
        }
        
        .mini-dropdown-content {
            position: absolute;
            top: 100%;
            left: 0;
            min-width: 280px;
            background: #1a202c;
            border: 1px solid #4a5568;
            border-radius: 8px;
            padding: 12px;
            z-index: 1000;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            display: none;
        }
        
        .mini-dropdown-content.show {
            display: block;
        }
        
        .mini-dropdown-content .input-row {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
        }
        
        .mini-dropdown-content .input-row label {
            flex: 1;
            font-size: 0.8rem;
            color: #a0aec0;
        }
        
        .mini-dropdown-content .input-row input {
            width: 70px;
            padding: 5px 8px;
            background: #2d3748;
            border: 1px solid #4a5568;
            border-radius: 4px;
            color: white;
            font-size: 0.8rem;
            text-align: center;
        }
        
        .mini-dropdown-content .btn-aplicar {
            width: 100%;
            padding: 8px;
            background: #4299e1;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 0.8rem;
            cursor: pointer;
            margin-top: 5px;
        }
        
        .mini-dropdown-content .btn-aplicar:hover {
            background: #3182ce;
        }
        
        /* Bot√µes do Modal */
        .btn-limpar-modal {
            padding: 10px 20px;
            background: #4a5568;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 0.9rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
        }
        
        .btn-limpar-modal:hover {
            background: #2d3748;
        }
        
        .btn-aplicar-modal {
            padding: 10px 20px;
            background: linear-gradient(135deg, #48bb78, #38a169);
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 0.9rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
        }
        
        .btn-aplicar-modal:hover {
            background: linear-gradient(135deg, #38a169, #2f855a);
            transform: translateY(-1px);
        }
        
        /* Bot√£o Premium Bloqueado */
        .btn-premium-bloqueado {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 12px;
            background: linear-gradient(135deg, #553C9A, #6B46C1);
            color: #E9D8FD;
            border: 1px solid #805AD5;
            border-radius: 6px;
            font-size: 0.85rem;
            text-decoration: none;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }
        
        .btn-premium-bloqueado:hover {
            background: linear-gradient(135deg, #5865F2, #7289DA);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(88, 101, 242, 0.4);
        }
        
        .btn-premium-bloqueado .fa-lock {
            font-size: 0.7rem;
            color: #F6E05E;
        }
        
        /* Modal Premium Banner */
        .modal-premium-banner {
            max-width: 500px;
            background: linear-gradient(180deg, #1a202c 0%, #2d3748 100%);
            border: 2px solid #F6E05E;
        }
        
        .premium-beneficios {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin: 20px 0;
            text-align: left;
        }
        
        .beneficio-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 15px;
            background: rgba(246, 224, 94, 0.1);
            border-radius: 8px;
            border: 1px solid rgba(246, 224, 94, 0.3);
        }
        
        .beneficio-item i {
            color: #F6E05E;
            font-size: 1.1rem;
            width: 24px;
        }
        
        .beneficio-item span {
            color: #e2e8f0;
            font-size: 0.85rem;
        }
        
        .premium-preco {
            margin: 25px 0 15px;
        }
        
        .preco-valor {
            font-size: 2.5rem;
            font-weight: bold;
            color: #F6E05E;
        }
        
        .preco-periodo {
            font-size: 1rem;
            color: #a0aec0;
        }
        
        .btn-discord-premium {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            padding: 15px 40px;
            background: linear-gradient(135deg, #5865F2, #7289DA);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: bold;
            text-decoration: none;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn-discord-premium:hover {
            background: linear-gradient(135deg, #4752C4, #5865F2);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(88, 101, 242, 0.5);
        }
        
        /* Linha de filtros principais */
        .filtros-linha-principal {
            display: flex;
            flex-wrap: wrap;
            gap: 10px 12px;
            align-items: flex-end;
            justify-content: flex-start;
            width: 100%;
        }
        
        /* Separador de filtros */
        .filtros-separador {
            width: 1px;
            height: 35px;
            background: #4a5568;
            margin: 0 5px;
            flex-shrink: 0;
        }
        
        /* Select compacto */
        .select-compacto {
            padding: 8px 12px;
            background: #2d3748;
            border: 1px solid #4a5568;
            border-radius: 6px;
            color: #e2e8f0;
            font-size: 0.8rem;
            cursor: pointer;
            min-width: 130px;
        }
        
        .select-compacto:hover {
            border-color: #667eea;
        }
        
        /* Input compacto */
        .input-compacto {
            padding: 8px 12px;
            background: #2d3748;
            border: 1px solid #4a5568;
            border-radius: 6px;
            color: #e2e8f0;
            font-size: 0.8rem;
            width: 100px;
        }
        
        .input-compacto::placeholder {
            color: #718096;
        }
        
        /* Grupo com label */
        .filtro-grupo-inline {
            display: flex;
            flex-direction: column;
            gap: 3px;
        }
        
        .filtro-grupo-inline label {
            font-size: 0.65rem;
            color: #718096;
            text-transform: uppercase;
        }
        
        /* Bot√µes de a√ß√£o compactos */
        .btn-acao-compacto {
            padding: 10px 18px;
            background: linear-gradient(135deg, #2d3748 0%, #1a202c 100%);
            color: #e2e8f0;
            border: 1px solid #4a5568;
            border-radius: 8px;
            font-size: 0.85rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
            height: 40px;
            box-sizing: border-box;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .btn-acao-compacto:hover {
            background: linear-gradient(135deg, #4a5568 0%, #2d3748 100%);
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }
        
        .btn-acao-compacto i {
            color: #4299e1;
        }

        /* Filtros Ativos (exibidos abaixo do formul√°rio) */
        .filtros-ativos-box {
            background: linear-gradient(135deg, #1a202c 0%, #2d3748 100%);
            border: 1px solid #4a5568;
            border-radius: 8px;
            padding: 12px 15px;
            margin: 10px 0;
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 10px;
        }
        
        .filtros-ativos-box .filtro-label {
            color: #f6e05e;
            font-weight: bold;
            font-size: 0.85rem;
        }
        
        .filtros-ativos-box .filtro-item {
            background: #4a5568;
            color: #e2e8f0;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .filtros-ativos-box .filtro-item .remover-filtro {
            cursor: pointer;
            color: #fc8181;
            font-weight: bold;
        }
        
        .filtros-ativos-box .limpar-todos {
            background: transparent;
            border: 1px solid #718096;
            color: #a0aec0;
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 0.75rem;
            cursor: pointer;
        }
        
        .filtros-ativos-box .limpar-todos:hover {
            background: #718096;
            color: #fff;
        }

        
        .btn-buscar-principal {
            padding: 8px 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 0.85rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            font-weight: 500;
        }
        
        .btn-buscar-principal:hover {
            background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
            transform: translateY(-1px);
        }
        
        /* Contador de resultados */
        .contador-resultados {
            text-align: center;
            padding: 10px;
            background: #1a202c;
            border-radius: 8px;
            margin-bottom: 15px;
        }
        
        .contador-resultados .numero {
            font-size: 2.5rem;
            font-weight: bold;
            color: #4299e1;
        }
        
        .contador-resultados .texto {
            font-size: 0.75rem;
            color: #718096;
        }
        
        /* Tabs Listado/Com Lance - Estilos movidos para style.css */
        /* Os estilos dos tabs .tabs-status e .tab-status est√£o em static/style.css */
        
        .badge-premium-mini {
            background: linear-gradient(135deg, #F6E05E 0%, #ECC94B 100%);
            color: #1a202c;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.65rem;
            font-weight: bold;
        }
        
        /* Bot√£o Seja Premium */
        .btn-seja-premium {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 14px;
            background: linear-gradient(135deg, #F6E05E, #ECC94B);
            color: #1a202c;
            border: none;
            border-radius: 6px;
            font-size: 0.85rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn-seja-premium:hover {
            background: linear-gradient(135deg, #ECC94B, #D69E2E);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(246, 224, 94, 0.4);
        }
        
        /* Campo de busca por nome */
        .busca-nome {
            width: 200px;
            padding: 8px 12px;
            background: #2d3748;
            border: 1px solid #4a5568;
            border-radius: 6px;
            color: #e2e8f0;
            font-size: 0.8rem;
        }
        
        .busca-nome::placeholder {
            color: #718096;
        }
        
        /* Grid de Esp√≠ritos */
        .espiritos-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: center;
        }
        
        .espirito-item {
            width: 55px;
            height: 55px;
            border-radius: 8px;
            overflow: hidden;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.2s ease;
            background: #2d3748;
        }
        
        .espirito-item:hover {
            border-color: #667eea;
            transform: scale(1.1);
        }
        
        .espirito-item.selected {
            border-color: #48bb78;
            box-shadow: 0 0 10px rgba(72, 187, 120, 0.5);
        }
        
        .espirito-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        /* Grid de Skills/Habilidades */
        .skills-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin-top: 15px;
        }
        
        .skill-item {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            overflow: hidden;
            cursor: pointer;
            border: 3px solid transparent;
            transition: all 0.2s ease;
            background: #2d3748;
            filter: grayscale(100%);
            opacity: 0.6;
        }
        
        .skill-item:hover {
            filter: grayscale(0%);
            opacity: 1;
            transform: scale(1.1);
        }
        
        .skill-item.epica {
            border-color: #e53e3e;
            filter: grayscale(0%);
            opacity: 1;
            box-shadow: 0 0 15px rgba(229, 62, 62, 0.6);
        }
        
        .skill-item.lendaria {
            border-color: #f6e05e;
            filter: grayscale(0%);
            opacity: 1;
            box-shadow: 0 0 15px rgba(246, 224, 94, 0.6);
        }
        
        .skill-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .skills-legenda {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-bottom: 15px;
            font-size: 0.85rem;
        }
        
        .skills-legenda span {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .legenda-cor {
            width: 15px;
            height: 15px;
            border-radius: 50%;
        }
        
        .legenda-cor.epica { background: #e53e3e; }
        .legenda-cor.lendaria { background: #f6e05e; }
        
        /* Badge Bidding */
        .badge-bidding {
            position: absolute;
            top: 6px;
            left: -28px;
            background: linear-gradient(135deg, #f97316 0%, #ea580c 100%);
            color: white;
            padding: 3px 28px;
            font-size: 0.55rem;
            font-weight: bold;
            transform: rotate(-45deg);
            z-index: 100;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            text-shadow: 1px 1px 1px rgba(0,0,0,0.3);
        }
        
        /* Ribbon effect - sombra inferior */
        .badge-bidding::before {
            content: '';
            position: absolute;
            left: 0;
            bottom: -3px;
            border-left: 3px solid transparent;
            border-right: 3px solid #c2410c;
            border-top: 3px solid #c2410c;
            border-bottom: 3px solid transparent;
        }
        
        .badge-bidding::after {
            content: '';
            position: absolute;
            right: 0;
            bottom: -3px;
            border-left: 3px solid #c2410c;
            border-right: 3px solid transparent;
            border-top: 3px solid #c2410c;
            border-bottom: 3px solid transparent;
        }
        
        /* Card com scroll interno, s√≥ ribbon sai */
        .nft-card {
            overflow: hidden !important;
            position: relative;
        }
        
        .card-top-bar {
            overflow: visible !important;
            position: relative;
            z-index: 100;
        }
        
        .tab-content {
            overflow-y: auto !important;
            overflow-x: hidden !important;
            max-height: 450px;
        }
        
        .tempo-restante {
            position: absolute;
            top: 8px;
            right: 8px;
            background: rgba(0,0,0,0.7);
            color: #f6e05e;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: bold;
        }
        
        /* Timer de Leil√£o no Card */
        .card-timer {
            margin-left: 50px;
            background: linear-gradient(135deg, #ed8936 0%, #dd6b20 100%);
            color: white;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.65rem;
            font-weight: bold;
            display: inline-flex;
            align-items: center;
            gap: 4px;
            flex-shrink: 0;
        }
        
        .card-timer i {
            font-size: 0.6rem;
        }
        
        .card-timer.timer-expired {
            background: linear-gradient(135deg, #e53e3e 0%, #c53030 100%);
        }
        
        /* Ajustar top-bar para ter timer no meio */
        .card-top-bar {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .card-price-top {
            margin-left: auto;
        }
        
        /* ============ ESTILOS ANTERIORES ============ */
        .carregar-mais-btn {
            width: 100%;
            padding: 10px 15px;
            margin-top: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .carregar-mais-btn:hover {
            background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .carregar-mais-btn:disabled {
            background: #4a5568;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .carregar-mais-btn i {
            font-size: 0.9rem;
        }
        
        /* Estilos Premium */
        .premium-badge {
            background: linear-gradient(135deg, #f6ad55 0%, #ed8936 100%);
            color: #1a202c;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.7rem;
            font-weight: bold;
            margin-left: 5px;
        }
        
        .premium-filter {
            position: relative;
        }
        
        .premium-filter.locked::after {
            content: "üîí Premium";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #f6ad55;
            font-size: 0.8rem;
            border-radius: 5px;
            cursor: not-allowed;
        }
        
        .premium-filter.locked input,
        .premium-filter.locked select {
            pointer-events: none;
            opacity: 0.5;
        }
        
        .user-nav {
            display: flex;
            flex-direction: row;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
            justify-content: flex-start;
            padding: 10px 15px;
            background: #2d3748;
            border-radius: 8px;
            margin-bottom: 15px;
        }
        
        .user-nav a,
        .user-nav .btn-auth {
            color: #e2e8f0;
            text-decoration: none;
            padding: 8px 15px;
            border-radius: 6px;
            transition: all 0.3s ease;
            background: #4a5568;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            font-size: 0.9rem;
            border: none;
            cursor: pointer;
        }
        
        .user-nav a:hover,
        .user-nav .btn-auth:hover {
            background: #667eea;
            color: white;
        }
        
        .user-nav .user-status {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-left: auto;
        }
        
        /* Dropdown colaps√°vel de Filtros */
        .dropdown-filtro {
            margin-bottom: 10px;
        }
        
        .dropdown-btn {
            width: 100%;
            padding: 10px 12px;
            background: #2d3748;
            border: 1px solid #4a5568;
            border-radius: 8px;
            color: #e2e8f0;
            font-size: 0.85rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: all 0.3s ease;
        }
        
        .dropdown-btn:hover {
            background: #3d4a5c;
            border-color: #667eea;
        }
        
        .dropdown-btn span:first-child {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .dropdown-count {
            color: #a0aec0;
            font-size: 0.75rem;
            margin-left: auto;
            margin-right: 10px;
        }
        
        .dropdown-arrow {
            transition: transform 0.3s ease;
        }
        
        .dropdown-filtro.open .dropdown-arrow {
            transform: rotate(180deg);
        }
        
        .dropdown-content {
            padding: 15px;
            background: #1a202c;
            border: 1px solid #4a5568;
            border-top: none;
            border-radius: 0 0 8px 8px;
            margin-top: -5px;
        }
        
        .btn-aplicar-dropdown {
            width: 100%;
            padding: 8px;
            margin-top: 10px;
            background: #4299e1;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8rem;
        }
        
        .btn-aplicar-dropdown:hover {
            background: #3182ce;
        }
        
        /* Bot√µes secund√°rios menores */
        .botoes-filtro-grupo {
            display: flex;
            gap: 8px;
            margin-bottom: 10px;
        }
        
        .btn-filtro-secundario {
            flex: 1;
            padding: 8px 10px;
            background: #4a5568;
            color: #e2e8f0;
            border: 1px solid #4a5568;
            border-radius: 6px;
            font-size: 0.75rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
            transition: all 0.3s ease;
        }
        
        .btn-filtro-secundario:hover {
            background: #5a6a7c;
            border-color: #667eea;
        }
        
        .btn-filtro-secundario i {
            font-size: 0.7rem;
        }
        
        .user-status {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-left: auto;
        }
        
        .user-status .premium-user {
            color: #f6ad55;
            font-weight: bold;
        }
/* ===== ESTILOS DOS MODAIS DE AUTENTICA√á√ÉO ===== */
.modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.85);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 10000;
    backdrop-filter: blur(5px);
}

.modal-container {
    background: linear-gradient(145deg, #1a202c 0%, #2d3748 100%);
    border-radius: 16px;
    box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
    overflow: hidden;
    animation: modalSlideIn 0.3s ease-out;
}

@keyframes modalSlideIn {
    from {
        opacity: 0;
        transform: translateY(-30px) scale(0.95);
    }
    to {
        opacity: 1;
        transform: translateY(0) scale(1);
    }
}

.modal-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    padding: 20px 25px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.modal-header h2 {
    margin: 0;
    color: #fff;
    font-size: 1.3rem;
    display: flex;
    align-items: center;
    gap: 10px;
}

.modal-close {
    background: rgba(255, 255, 255, 0.2);
    border: none;
    color: #fff;
    font-size: 1.5rem;
    width: 35px;
    height: 35px;
    border-radius: 50%;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
}

.modal-close:hover {
    background: rgba(255, 255, 255, 0.3);
    transform: rotate(90deg);
}

.modal-body {
    padding: 25px;
}

.modal-error {
    background: rgba(229, 62, 62, 0.2);
    border: 1px solid #e53e3e;
    color: #fc8181;
    padding: 10px 15px;
    border-radius: 8px;
    margin-bottom: 15px;
    font-size: 0.9rem;
}

.modal-footer-links {
    text-align: center;
    margin-top: 20px;
    padding-top: 20px;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
}

.modal-footer-links a {
    color: #667eea;
    text-decoration: none;
    font-weight: 500;
}

.modal-footer-links a:hover {
    text-decoration: underline;
}

.modal-auth {
    max-width: 420px;
    width: 95%;

.form-group-modal {
    margin-bottom: 18px;
}

.form-group-modal label {
    display: block;
    margin-bottom: 8px;
    color: #e2e8f0;
    font-weight: 500;
    font-size: 0.9rem;
}

.form-group-modal input[type="text"],
.form-group-modal input[type="email"],
.form-group-modal input[type="password"] {
    width: 100%;
    padding: 12px 14px;
    background: rgba(45, 55, 72, 0.8);
    border: 1px solid rgba(102, 126, 234, 0.3);
    border-radius: 8px;
    color: #fff;
    font-size: 0.95rem;
    transition: all 0.3s ease;
}

.form-group-modal input:focus {
    outline: none;
    border-color: #667eea;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2);
}

.form-group-modal input::placeholder {
    color: #718096;
}

.checkbox-inline {
    display: flex;
    align-items: center;
    gap: 10px;
}

.checkbox-inline input[type="checkbox"] {
    width: 18px;
    height: 18px;
    cursor: pointer;
}

.checkbox-inline label {
    margin-bottom: 0;
    cursor: pointer;
    font-size: 0.85rem;
}

.btn-modal-submit {
    width: 100%;
    padding: 14px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border: none;
    border-radius: 8px;
    color: #fff;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    margin-top: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
}

.btn-modal-submit:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
}

.btn-modal-submit.btn-register {
    background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
}

.btn-modal-submit.btn-register:hover {
    box-shadow: 0 10px 30px rgba(72, 187, 120, 0.4);
}

.modal-error {
    background: rgba(245, 101, 101, 0.2);
    border: 1px solid #f56565;
    color: #f56565;
    padding: 10px 14px;
    border-radius: 8px;
    font-size: 0.85rem;
    margin-bottom: 15px;
}

.modal-success {
    background: rgba(72, 187, 120, 0.2);
    border: 1px solid #48bb78;
    color: #48bb78;
    padding: 10px 14px;
    border-radius: 8px;
    font-size: 0.85rem;
    margin-bottom: 15px;
}

.modal-footer-links {
    text-align: center;
    margin-top: 20px;
    padding-top: 15px;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
}

.modal-footer-links p {
    color: #a0aec0;
    font-size: 0.9rem;
}

.modal-footer-links a {
    color: #667eea;
    text-decoration: none;
    font-weight: 500;
}

.modal-footer-links a:hover {
    color: #764ba2;
}

/* Bot√µes de Login/Cadastro na navbar */
.user-nav .btn-auth {
    background: rgba(45, 55, 72, 0.8) !important;
    border: 1px solid rgba(102, 126, 234, 0.5) !important;
    color: #e2e8f0 !important;
    padding: 8px 16px !important;
    border-radius: 8px !important;
    cursor: pointer !important;
    font-size: 0.9rem !important;
    transition: all 0.3s ease !important;
    display: inline-flex !important;
    align-items: center !important;
    gap: 8px !important;
    font-weight: 500 !important;
}

.user-nav .btn-auth:hover {
    background: rgba(102, 126, 234, 0.3) !important;
    color: #fff !important;
    border-color: #667eea !important;
    transform: translateY(-1px);
}

.user-nav .btn-auth.btn-cadastrar {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
    border: none !important;
    color: #fff !important;
}

.user-nav .btn-auth.btn-cadastrar:hover {
    transform: translateY(-2px) !important;
    box-shadow: 0 5px 20px rgba(102, 126, 234, 0.5) !important;
}

/* ===== LOG DE CACHE ===== */
.cache-log-container {
    background: rgba(0, 0, 0, 0.4);
    border: 1px solid rgba(102, 126, 234, 0.2);
    border-radius: 8px;
    margin-top: 15px;
    max-height: 150px;
    overflow-y: auto;
}

.cache-log-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 12px;
    background: rgba(102, 126, 234, 0.1);
    border-bottom: 1px solid rgba(102, 126, 234, 0.2);
    cursor: pointer;
}

.cache-log-header h4 {
    margin: 0;
    font-size: 0.8rem;
    color: #a0aec0;
}

.cache-log-content {
    padding: 8px 12px;
    font-family: 'Courier New', monospace;
    font-size: 0.75rem;
    color: #48bb78;
    max-height: 100px;
    overflow-y: auto;
}

.cache-log-content .log-line {
    margin-bottom: 3px;
    display: flex;
    gap: 8px;
}

.cache-log-content .log-time {
    color: #718096;
}

.cache-log-content .log-success {
    color: #48bb78;
}

.cache-log-content .log-error {
    color: #f56565;
}

.cache-log-content .log-info {
    color: #667eea;
}

/* ========== FILTROS ATIVOS ========== */
.filtros-ativos-area {
    background: linear-gradient(135deg, #1a1f2e 0%, #2d3748 100%);
    border: 1px solid #4a5568;
    border-radius: 8px;
    padding: 12px 16px;
    margin-bottom: 15px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
}

.filtros-ativos-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
}

.filtros-ativos-titulo {
    color: #e2e8f0;
    font-size: 0.85rem;
    font-weight: 600;
}

.filtros-ativos-titulo i {
    color: #667eea;
    margin-right: 6px;
}

.btn-limpar-todos {
    background: linear-gradient(135deg, #4a5568 0%, #2d3748 100%) !important;
    color: #e2e8f0 !important;
    border: 1px solid #4a5568 !important;
    padding: 5px 12px;
    border-radius: 20px;
    font-size: 0.7rem;
    cursor: pointer;
    transition: all 0.2s ease;
    display: inline-flex;
    align-items: center;
    gap: 4px;
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.btn-limpar-todos:hover {
    background: linear-gradient(135deg, #e53e3e 0%, #c53030 100%) !important;
    color: white !important;
    border-color: #e53e3e !important;
    transform: translateY(-1px);
    box-shadow: 0 2px 8px rgba(229, 62, 62, 0.3);
}

.filtros-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
}

.filtro-tag {
    background: linear-gradient(135deg, #2d3748 0%, #4a5568 100%);
    border: 1px solid #667eea;
    border-radius: 20px;
    padding: 5px 12px;
    font-size: 0.75rem;
    color: #e2e8f0;
    display: flex;
    align-items: center;
    gap: 8px;
    transition: all 0.2s ease;
}

.filtro-tag:hover {
    background: linear-gradient(135deg, #4a5568 0%, #5a6678 100%);
    box-shadow: 0 2px 4px rgba(102, 126, 234, 0.3);
}

.filtro-tag .tag-label {
    color: #a0aec0;
    font-weight: 500;
}

.filtro-tag .tag-value {
    color: #f6e05e;
    font-weight: 600;
}

.filtro-tag .tag-remover {
    color: #f56565;
    cursor: pointer;
    font-size: 0.8rem;
    margin-left: 4px;
    transition: color 0.2s ease;
}

.filtro-tag .tag-remover:hover {
    color: #fc8181;
}
    </style>
</head>
<body>
<input type="hidden" name="csrf_token" id="csrf-global" value="{{ csrf_token() }}">
    <div class="container layout-horizontal">
        
        <!-- Barra de usu√°rio -->
        <div class="user-nav">
            {% if current_user.is_authenticated %}
                <a href="{{ url_for('auth.profile') }}"><i class="fas fa-user"></i> {{ current_user.username }}</a>
                {% if current_user.is_admin %}
                    <a href="{{ url_for('admin.dashboard') }}"><i class="fas fa-cog"></i> Admin</a>
                {% endif %}
                <div class="user-status">
                    {% if is_premium %}
                        <span class="premium-user"><i class="fas fa-crown"></i> Premium ({{ current_user.premium_days_remaining }} dias)</span>
                    {% else %}
                        <button type="button" onclick="abrirModalPremium()" class="btn-seja-premium">
                            <i class="fas fa-crown"></i> Seja Premium
                        </button>
                    {% endif %}
                    <a href="{{ url_for('auth.logout') }}"><i class="fas fa-sign-out-alt"></i> Sair</a>
                </div>
            {% else %}
                <button type="button" class="btn-auth" onclick="abrirModalLogin()"><i class="fas fa-sign-in-alt"></i> Login</button>
                <button type="button" class="btn-auth btn-cadastrar" onclick="abrirModalRegister()"><i class="fas fa-user-plus"></i> Cadastrar</button>
                <div class="user-status">
                    <span style="color: #a0aec0;">Visitante</span>
                </div>
            {% endif %}
        </div>
        
        <!-- ============ NOVO LAYOUT COMPACTO ============ -->
        <div class="filtros-topo">
            <!-- Linha 1: Filtros principais -->
            <div class="filtros-linha-principal" style="width: 100%; flex-wrap: wrap;">
                
                <!-- Classe -->
                <div class="filtro-grupo-inline">
                    <label>Classe</label>
                    <select id="classe" name="classe" class="select-compacto">
                        <option value="0">Todas</option>
                        {% for id, info in classes.items() %}
                        <option value="{{ id }}">{{ info.nome }}</option>
                        {% endfor %}
                    </select>
                </div>
                
                <!-- Servidor -->
                <div class="filtro-grupo-inline">
                    <label>Regi√£o</label>
                    <select id="regiao" name="regiao" class="select-compacto" onchange="atualizarServidores()">
                        <option value="">Todas</option>
                        <option value="ASIA1">ASIA1</option>
                        <option value="ASIA2">ASIA2</option>
                        <option value="ASIA3">ASIA3</option>
                        <option value="ASIA4">ASIA4</option>
                        <option value="INMENA1">INMENA1</option>
                        <option value="EU1">EU1</option>
                        <option value="SA1">SA1</option>
                        <option value="SA2">SA2</option>
                        <option value="NA1">NA1</option>
                        <option value="NA2">NA2</option>
                    </select>
                </div>
                
                <div class="filtro-grupo-inline">
                    <label>Servidor</label>
                    <select id="servidor" name="servidor" class="select-compacto">
                        <option value="">Todos</option>
                    </select>
                </div>
                
                <!-- Level e Poder -->
                <div class="filtro-grupo-inline">
                    <label>Level M√≠n.</label>
                    <input type="number" id="level_min" class="input-compacto" placeholder="0">
                </div>
                
                <div class="filtro-grupo-inline">
                    <label>Poder M√≠n.</label>
                    <input type="number" id="power_min" class="input-compacto" placeholder="0">
                </div>
                
                <!-- Pre√ßo -->
                <div class="filtro-grupo-inline">
                    <label>Pre√ßo M√≠n.</label>
                    <input type="number" id="price_min" class="input-compacto" placeholder="0">
                </div>
                
                <div class="filtro-grupo-inline">
                    <label>Pre√ßo M√°x.</label>
                    <input type="number" id="price_max" class="input-compacto" placeholder="10000">
                </div>
                
                <!-- Ordena√ß√£o -->
                <div class="filtro-grupo-inline">
                    <label>Ordenar por</label>
                    <select id="ordenacao" class="select-compacto" onchange="mudarOrdenacao()">
                        <option value="power">Maior Poder</option>
                        <option value="level">Maior Level</option>
                        <option value="critico">Maior Cr√≠tico</option>
                        <option value="evasao">Maior Evas√£o</option>
                        <option value="derrubada">Maior Derrubada</option>
                        <option value="evasao_critico">Maior Evas√£o Cr√≠tico</option>
                        <option value="ataque_fisico">Maior ATK F√≠sico</option>
                        <option value="ataque_magico">Maior ATK M√°gico</option>
                        <option value="price">Menor Pre√ßo</option>
                        <option value="price_desc">Maior Pre√ßo</option>
                        {% if is_premium %}
                        <option value="aceleramento">Maior Minera√ß√£o</option>
                        <option value="aconegro">Mais A√ßo Negro</option>
                        {% endif %}
                        <option value="codex">Maior Codex</option>
                        <option value="mina">Maior N√≠vel Mina</option>
                    </select>
                </div>
                
                <!-- Dropdowns de filtros avan√ßados -->
                
                {% if is_premium %}
                <!-- Dropdown Minera√ß√£o -->
                <div class="mini-dropdown">
                    <button type="button" class="mini-dropdown-btn" onclick="toggleMiniDropdown('dd-mineracao')">
                        <span><i class="fas fa-gem"></i> Minera√ß√£o</span>
                        <span class="mini-dropdown-count" id="count-mineracao">0</span>
                        <i class="fas fa-chevron-down"></i>
                    </button>
                    <div id="dd-mineracao" class="mini-dropdown-content">
                        <div class="input-row">
                            <label>Mina (N√≠vel)</label>
                            <input type="number" id="mina_min" placeholder="0" onchange="atualizarCountMineracao()">
                        </div>
                        <div class="input-row">
                            <label style="color: #f6e05e;">Boost Minera√ß√£o (%)</label>
                            <input type="number" id="status_aceleramento" placeholder="0" onchange="atualizarCountMineracao()">
                        </div>
                        <div class="input-row">
                            <label style="color: #f6e05e;">Ganho A√ßo Negro (%)</label>
                            <input type="number" id="status_aconegro" placeholder="0" onchange="atualizarCountMineracao()">
                        </div>
                        <button type="button" class="btn-aplicar" onclick="toggleMiniDropdown('dd-mineracao')">Aplicar</button>
                    </div>
                </div>
                {% else %}
                <!-- Minera√ß√£o bloqueado -->
                <a href="https://discord.gg/deSKDPNzAW" target="_blank" class="btn-premium-bloqueado">
                    <i class="fas fa-gem"></i> Minera√ß√£o <i class="fas fa-lock"></i>
                </a>
                {% endif %}
                
                {% if is_premium %}
                <!-- Dropdown Training/Treino -->
                <div class="mini-dropdown">
                    <button type="button" class="mini-dropdown-btn" onclick="toggleMiniDropdown('dd-treino')">
                        <span><i class="fas fa-dumbbell"></i> Treino</span>
                        <span class="mini-dropdown-count" id="count-treino">0</span>
                        <i class="fas fa-chevron-down"></i>
                    </button>
                    <div id="dd-treino" class="mini-dropdown-content">
                        <div class="input-row">
                            <label>Constitui√ß√£o</label>
                            <input type="number" id="treino_constituicao" placeholder="0" min="0" max="23" onchange="atualizarCountTreino()">
                            <span style="color:#718096;font-size:0.7rem;">/23</span>
                        </div>
                        <div class="input-row">
                            <label>M√∫sculo</label>
                            <input type="number" id="treino_muscular" placeholder="0" min="0" max="23" onchange="atualizarCountTreino()">
                            <span style="color:#718096;font-size:0.7rem;">/23</span>
                        </div>
                        <div class="input-row">
                            <label>Nine Yin</label>
                            <input type="number" id="treino_noveyin" placeholder="0" min="0" max="23" onchange="atualizarCountTreino()">
                            <span style="color:#718096;font-size:0.7rem;">/23</span>
                        </div>
                        <div class="input-row">
                            <label>Nine Yang</label>
                            <input type="number" id="treino_noveyang" placeholder="0" min="0" max="23" onchange="atualizarCountTreino()">
                            <span style="color:#718096;font-size:0.7rem;">/23</span>
                        </div>
                        <div class="input-row">
                            <label>Postura Sapo</label>
                            <input type="number" id="treino_sapo" placeholder="0" min="0" max="23" onchange="atualizarCountTreino()">
                            <span style="color:#718096;font-size:0.7rem;">/23</span>
                        </div>
                        <button type="button" class="btn-aplicar" onclick="toggleMiniDropdown('dd-treino')">Aplicar</button>
                    </div>
                </div>
                {% else %}
                <!-- Treino bloqueado -->
                <a href="https://discord.gg/deSKDPNzAW" target="_blank" class="btn-premium-bloqueado">
                    <i class="fas fa-dumbbell"></i> Treino <i class="fas fa-lock"></i>
                </a>
                {% endif %}
                
                <!-- Dropdown N√≠vel (Codex/Potencial) -->
                <div class="mini-dropdown">
                    <button type="button" class="mini-dropdown-btn" onclick="toggleMiniDropdown('dd-nivel')">
                        <span><i class="fas fa-chart-line"></i> Codex</span>
                        <span class="mini-dropdown-count" id="count-nivel">0</span>
                        <i class="fas fa-chevron-down"></i>
                    </button>
                    <div id="dd-nivel" class="mini-dropdown-content">
                        <div class="input-row">
                            <label>Codex M√≠n.</label>
                            <input type="number" id="codex_min" placeholder="0" onchange="atualizarCountNivel()">
                        </div>
                        <div class="input-row">
                            <label>Potencial M√≠n.</label>
                            <input type="number" id="potencial_min" placeholder="0" onchange="atualizarCountNivel()">
                        </div>
                        <div class="input-row">
                            <label>Equip. Lend√°rios</label>
                            <input type="number" id="itens_comercio_min" placeholder="0" min="0" max="10" onchange="atualizarCountNivel()">
                            <span style="color:#718096;font-size:0.65rem;">m√°x 10</span>
                        </div>
                        <button type="button" class="btn-aplicar" onclick="toggleMiniDropdown('dd-nivel')">Aplicar</button>
                    </div>
                </div>
                
                {% if is_premium %}
                <!-- Dropdown Trade (Itens Comercializ√°veis) -->
                <div class="mini-dropdown">
                    <button type="button" class="mini-dropdown-btn" onclick="toggleMiniDropdown('dd-trade')">
                        <span><i class="fas fa-balance-scale"></i> Trade</span>
                        <span class="mini-dropdown-count" id="count-trade">0</span>
                        <i class="fas fa-chevron-down"></i>
                    </button>
                    <div id="dd-trade" class="mini-dropdown-content">
                        <p style="font-size: 0.75rem; color: #a0aec0; margin-bottom: 10px;">
                            Filtrar por itens equipados comercializ√°veis (com balan√ßa)
                        </p>
                        <div class="input-row">
                            <label style="flex:2;">Equipamentos Lend√°rios Trade</label>
                            <input type="number" id="equip_lend_trade_min" placeholder="0" min="0" onchange="atualizarCountTrade()">
                        </div>
                        <div class="input-row">
                            <label style="flex:2;">Equipamentos √âpicos Trade</label>
                            <input type="number" id="equip_epic_trade_min" placeholder="0" min="0" onchange="atualizarCountTrade()">
                        </div>
                        <button type="button" class="btn-aplicar" onclick="toggleMiniDropdown('dd-trade')">Aplicar</button>
                    </div>
                </div>
                {% else %}
                <!-- Trade bloqueado -->
                <a href="https://discord.gg/deSKDPNzAW" target="_blank" class="btn-premium-bloqueado">
                    <i class="fas fa-balance-scale"></i> Trade <i class="fas fa-lock"></i>
                </a>
                {% endif %}
                
                {% if is_premium %}
                <!-- Bot√£o Status Avan√ßados -->
                <button type="button" class="btn-acao-compacto" onclick="abrirModalStatus(event)">
                    <i class="fas fa-sliders-h"></i> Status
                </button>
                {% else %}
                <!-- Status bloqueado -->
                <a href="https://discord.gg/deSKDPNzAW" target="_blank" class="btn-premium-bloqueado">
                    <i class="fas fa-sliders-h"></i> Status <i class="fas fa-lock"></i>
                </a>
                {% endif %}
                
                {% if is_premium %}
                <!-- Bot√£o Filtro de Itens -->
                <button type="button" class="btn-acao-compacto" onclick="abrirModalItens(event)">
                    <i class="fas fa-box-open"></i> Itens
                </button>
                {% else %}
                <!-- Itens bloqueado -->
                <a href="https://discord.gg/deSKDPNzAW" target="_blank" class="btn-premium-bloqueado">
                    <i class="fas fa-box-open"></i> Itens <i class="fas fa-lock"></i>
                </a>
                {% endif %}
                
                {% if is_premium %}
                <!-- Bot√£o Filtro de Esp√≠ritos -->
                <button type="button" class="btn-acao-compacto" onclick="abrirModalEspiritos(event)">
                    <i class="fas fa-ghost"></i> Esp√≠ritos <span id="count-espiritos" class="mini-dropdown-count">0</span>
                </button>
                {% else %}
                <!-- Esp√≠ritos bloqueado -->
                <a href="https://discord.gg/deSKDPNzAW" target="_blank" class="btn-premium-bloqueado">
                    <i class="fas fa-ghost"></i> Esp√≠ritos <i class="fas fa-lock"></i>
                </a>
                {% endif %}
                
                {% if is_premium %}
                <!-- Bot√£o Filtro de Habilidades -->
                <button type="button" class="btn-acao-compacto" onclick="abrirModalHabilidades(event)" style="border-color: #f6e05e;">
                    <i class="fas fa-magic"></i> Skills <span id="count-skills" class="mini-dropdown-count">0</span>
                </button>
                {% else %}
                <!-- Skills bloqueado -->
                <a href="https://discord.gg/deSKDPNzAW" target="_blank" class="btn-premium-bloqueado" style="border-color: #f6e05e;">
                    <i class="fas fa-magic"></i> Skills <i class="fas fa-lock"></i>
                </a>
                {% endif %}
                
                <!-- Busca por nome -->
                <input type="text" id="busca_nome" class="busca-nome" placeholder="Nome do jogador...">
                
                <!-- Bot√£o Buscar -->
                <button type="button" class="btn-buscar-principal" onclick="buscarContas()">
                    <i class="fas fa-search"></i> Buscar
                </button>
                
                {% if is_admin %}
                <!-- Bot√µes Cache (s√≥ admin) -->
                <button type="button" class="btn-acao-compacto" onclick="carregarCacheTeste()">
                    <i class="fas fa-database"></i> Cache 10
                </button>
                <button type="button" class="btn-acao-compacto" onclick="carregarCacheCompleto()">
                    <i class="fas fa-database"></i> Cache Full
                </button>
                
                <!-- Log de Cache -->
                <div class="cache-log-container" id="cache-log-container" style="margin-top: 10px; max-width: 300px;">
                    <div class="cache-log-header" onclick="toggleCacheLog()">
                        <h4><i class="fas fa-terminal"></i> Log do Cache</h4>
                        <i id="cache-log-toggle-icon" class="fas fa-chevron-down"></i>
                    </div>
                    <div id="cache-info" style="padding: 5px 10px; font-size: 11px; color: #a0aec0; border-bottom: 1px solid #2d3748;">Status: <span style='color: #718096'>Aguardando...</span></div>
                    <div id="cache-log-content" class="cache-log-content" style="display: none;">
                        <div class="log-line"><span class="log-info">Aguardando a√ß√µes...</span></div>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
        <!-- Contador e tabs Listado/Com Lance -->
        <div class="contador-resultados">
            <div class="numero" id="total-nfts">0</div>
            <div class="texto">Total de NFTs (atualiza ao buscar)</div>
        </div>
        
        <div class="tabs-status">
            <button type="button" class="tab-status active" id="tab-listado" onclick="filtrarPorStatus('listado')">Listado</button>
            {% if is_premium %}
            <button type="button" class="tab-status" id="tab-bidding" onclick="filtrarPorStatus('bidding')">Com Lance</button>
            {% else %}
            <button type="button" class="tab-status tab-locked" onclick="abrirModalPremium()">
                <i class="fas fa-lock"></i> Com Lance <span class="badge-premium-mini">Premium</span>
            </button>
            {% endif %}
        </div>
        
        <!-- √Årea de Filtros Ativos -->
        <div id="filtros-ativos-area" class="filtros-ativos-area" style="display: none;">
            <div class="filtros-ativos-header">
                <span class="filtros-ativos-titulo"><i class="fas fa-filter"></i> Filtros Ativos:</span>
                <button type="button" class="btn-limpar-todos" onclick="limparTodosFiltros()">
                    <i class="fas fa-times-circle"></i> Limpar todos
                </button>
            </div>
            <div id="filtros-tags" class="filtros-tags">
                <!-- Tags de filtros ativos ser√£o inseridas via JS -->
            </div>
        </div>
        
        <!-- √Årea de Resultados -->
        <main>
            <div id="resultados" class="contas-grid">
                <div class="sem-resultados">
                    <i class="fas fa-search" style="font-size: 3rem; margin-bottom: 20px; opacity: 0.5;"></i>
                    <p>Configure os filtros e clique em Buscar</p>
                </div>
            </div>
            
            <div class="paginacao-container" id="paginacao-container" style="display: none;">
                <button class="btn-buscar" style="width: auto; padding: 10px 30px;" onclick="carregarMaisContas()">
                    Carregar Mais
                </button>
                <span id="info-paginacao" style="display: block; margin-top: 10px; color: #888;"></span>
            </div>
        </main>
        
        </div>
    </div>

    <!-- Modal de Habilidades -->
    <div id="modal-habilidades" class="modal" onclick="fecharModalHabilidades()">
        <div class="modal-conteudo" onclick="event.stopPropagation()" style="max-width: 750px;">
            <div class="modal-cabecalho">
                <h2><i class="fas fa-magic"></i> Filtro de Habilidades</h2>
                <span class="fechar-modal" onclick="fecharModalHabilidades()">&times;</span>
            </div>
            <div class="modal-corpo">
                <p style="font-size: 0.85rem; color: #a0aec0; margin-bottom: 10px;">
                    Selecione a classe e clique nas habilidades desejadas.
                </p>
                
                <div class="skills-legenda">
                    <span><span class="legenda-cor epica"></span> 1 clique = √âpica (N√≠vel 8-9)</span>
                    <span><span class="legenda-cor lendaria"></span> 2 cliques = Lend√°ria (N√≠vel 10)</span>
                </div>
                
                <!-- Seletor de Classe -->
                <div style="margin-bottom: 15px; text-align: center;">
                    <label style="color: #a0aec0; margin-right: 10px;">Classe:</label>
                    <select id="skill-classe" class="select-compacto" onchange="carregarSkillsClasse()" style="min-width: 180px;">
                        <option value="">Selecione uma classe</option>
                        <option value="1">Guerreiro</option>
                        <option value="2">Maga</option>
                        <option value="3">Tao√≠sta</option>
                        <option value="4">Lanceiro</option>
                        <option value="5">Arqueira</option>
                        <option value="6">Soturna</option>
                    </select>
                </div>
                
                <!-- Grid de Skills (din√¢mico) -->
                <div id="skills-container" class="skills-grid">
                    <p style="color: #718096; text-align: center; width: 100%;">
                        Selecione uma classe acima para ver as habilidades
                    </p>
                </div>
                
                <div style="margin-top: 20px; display: flex; gap: 10px; justify-content: center;">
                    <button type="button" class="btn-limpar-modal" onclick="limparSkills()"><i class="fas fa-times"></i> Limpar Sele√ß√£o</button>
                    <button type="button" class="btn-aplicar-modal" onclick="fecharModalHabilidades()"><i class="fas fa-check"></i> Aplicar Filtros</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Esp√≠ritos -->
    <div id="modal-espiritos" class="modal" onclick="fecharModalEspiritos()">
        <div class="modal-conteudo" onclick="event.stopPropagation()" style="max-width: 700px;">
            <div class="modal-cabecalho">
                <h2><i class="fas fa-ghost"></i> Filtro de Esp√≠ritos</h2>
                <span class="fechar-modal" onclick="fecharModalEspiritos()">&times;</span>
            </div>
            <div class="modal-corpo">
                <p style="font-size: 0.85rem; color: #a0aec0; margin-bottom: 10px;">
                    Clique nos esp√≠ritos que deseja filtrar. M√°ximo de 13 por vez.
                </p>
                
                <h4 style="color: #f6e05e; margin: 15px 0 10px;">Esp√≠ritos Lend√°rios (Grade 5) - 33 pets</h4>
                <div class="espiritos-grid" id="espiritos-lendarios">
                    <!-- Lend√°rios Grade 5 - Lista completa da API mir4collection -->
                    <div class="espirito-item" data-nome="Ghost Knight Styx" onclick="toggleEspirito(this)">
                        <img src="https://file.mir4global.com/xdraco-thumb/Content/UI/Atlas_N_Resource/Icon/Pet/Pet_Portrait/Icon_Item_Pet_Soul01.png" alt="Styx" title="Ghost Knight Styx">
                    </div>
                    <div class="espirito-item" data-nome="Wind Summoner Galesoul" onclick="toggleEspirito(this)">
                        <img src="https://file.mir4global.com/xdraco-thumb/Content/UI/Atlas_N_Resource/Icon/Pet/Pet_Portrait/Icon_Item_Wind01.png" alt="Galesoul" title="Wind Summoner Galesoul">
                    </div>
                    <div class="espirito-item" data-nome="North Sea Demon King Sumacheon" onclick="toggleEspirito(this)">
                        <img src="https://file.mir4global.com/xdraco-thumb/Content/UI/Atlas_N_Resource/Icon/Pet/Pet_Portrait/Icon_Item_Pet_IceGolem01.png" alt="Sumacheon" title="North Sea Demon King Sumacheon">
                    </div>
                    <div class="espirito-item" data-nome="Alluring Spirit Cat Lulu" onclick="toggleEspirito(this)">
                        <img src="https://file.mir4global.com/xdraco-thumb/Content/UI/Atlas_N_Resource/Icon/Pet/Pet_Portrait/Icon_Item_Pet_Fairy02.png" alt="Lulu" title="Alluring Spirit Cat Lulu">
                    </div>
                    <div class="espirito-item" data-nome="Little Rock Dragon Rocki" onclick="toggleEspirito(this)">
                        <img src="https://file.mir4global.com/xdraco-thumb/Content/UI/Atlas_N_Resource/Icon/Pet/Pet_Portrait/Icon_Item_Pet_Dragon09.png" alt="Rocki" title="Little Rock Dragon Rocki">
                    </div>
                    <div class="espirito-item" data-nome="Fire Hawk Goldking" onclick="toggleEspirito(this)">
                        <img src="https://file.mir4global.com/xdraco-thumb/Content/UI/Atlas_N_Resource/Icon/Pet/Pet_Portrait/Icon_Item_Pet_Eagle01.png" alt="Goldking" title="Fire Hawk Goldking">
                    </div>
                    <div class="espirito-item" data-nome="Hell Lord Inferno" onclick="toggleEspirito(this)">
                        <img src="https://file.mir4global.com/xdraco-thumb/Content/UI/Atlas_N_Resource/Icon/Pet/Pet_Portrait/Icon_Item_Pet_Fire01.png" alt="Inferno" title="Hell Lord Inferno">
                    </div>
                    <div class="espirito-item" data-nome="Bloodtip Drago" onclick="toggleEspirito(this)">
                        <img src="https://file.mir4global.com/xdraco-thumb/Content/UI/Atlas_N_Resource/Icon/Pet/Pet_Portrait/Icon_Item_Pet_Dragon03.png" alt="Drago" title="Bloodtip Drago">
                    </div>
                    <div class="espirito-item" data-nome="Dark Stallion Grifforse" onclick="toggleEspirito(this)">
                        <img src="https://file.mir4global.com/xdraco-thumb/Content/UI/Atlas_N_Resource/Icon/Pet/Pet_Portrait/Icon_Item_Pet_Centaur01.png" alt="Grifforse" title="Dark Stallion Grifforse">
                    </div>
                    <div class="espirito-item" data-nome="Luminous Setra" onclick="toggleEspirito(this)">
                        <img src="https://file.mir4global.com/xdraco-thumb/Content/UI/Atlas_N_Resource/Icon/Pet/Pet_Portrait/Icon_Item_Pet_Centaur02.png" alt="Setra" title="Luminous Setra">
                    </div>
                    <div class="espirito-item" data-nome="Grand GEN Khalion" onclick="toggleEspirito(this)">
                        <img src="https://file.mir4global.com/xdraco-thumb/Content/UI/Atlas_N_Resource/Icon/Pet/Pet_Portrait/Icon_Item_Pet_Tiger01.png" alt="Khalion" title="Grand GEN Khalion">
                    </div>
                    <div class="espirito-item" data-nome="Dark Crown Prince Wooska" onclick="toggleEspirito(this)">
                        <img src="https://file.mir4global.com/xdraco-thumb/Content/UI/Atlas_N_Resource/Icon/Pet/Pet_Portrait/Icon_Item_Pet_Tiger02.png" alt="Wooska" title="Dark Crown Prince Wooska">
                    </div>
                    <div class="espirito-item" data-nome="Diviner Octy" onclick="toggleEspirito(this)">
                        <img src="https://file.mir4global.com/xdraco-thumb/Content/UI/Atlas_N_Resource/Icon/Pet/Pet_Portrait/Icon_Item_Pet_Octopus01.png" alt="Octy" title="Diviner Octy">
                    </div>
                    <div class="espirito-item" data-nome="Red Eyes Lucy" onclick="toggleEspirito(this)">
                        <img src="https://file.mir4global.com/xdraco-thumb/Content/UI/Atlas_N_Resource/Icon/Pet/Pet_Portrait/Icon_Item_Pet_cat05.png" alt="Lucy" title="Red Eyes Lucy">
                    </div>
                    <div class="espirito-item" data-nome="Soothing Healer Haeryu" onclick="toggleEspirito(this)">
                        <img src="https://file.mir4global.com/xdraco-thumb/Content/UI/Atlas_N_Resource/Icon/Pet/Pet_Portrait/Icon_Item_Pet_Fish01.png" alt="Haeryu" title="Soothing Healer Haeryu">
                    </div>
                    <div class="espirito-item" data-nome="Resurrector Darknyan" onclick="toggleEspirito(this)">
                        <img src="https://file.mir4global.com/xdraco-thumb/Content/UI/Atlas_N_Resource/Icon/Pet/Pet_Portrait/Icon_Item_Pet_Cat03.png" alt="Darknyan" title="Resurrector Darknyan">
                    </div>
                    <div class="espirito-item" data-nome="Forest Fairy Lara" onclick="toggleEspirito(this)">
                        <img src="https://file.mir4global.com/xdraco-thumb/Content/UI/Atlas_N_Resource/Icon/Pet/Pet_Portrait/Icon_Item_Pet_Cat10.png" alt="Lara" title="Forest Fairy Lara">
                    </div>
                    <div class="espirito-item" data-nome="Butterfly Fairy Dreamfly" onclick="toggleEspirito(this)">
                        <img src="https://file.mir4global.com/xdraco-thumb/Content/UI/Atlas_N_Resource/Icon/Pet/Pet_Portrait/Icon_Item_Pet_Butterfly01.png" alt="Dreamfly" title="Butterfly Fairy Dreamfly">
                    </div>
                    <div class="espirito-item" data-nome="Fairy King Pepo" onclick="toggleEspirito(this)">
                        <img src="https://file.mir4global.com/xdraco-thumb/Content/UI/Atlas_N_Resource/Icon/Pet/Pet_Portrait/Icon_Item_Pet_Butterfly02.png" alt="Pepo" title="Fairy King Pepo">
                    </div>
                    <div class="espirito-item" data-nome="Luminous Empress Candela" onclick="toggleEspirito(this)">
                        <img src="https://file.mir4global.com/xdraco-thumb/Content/UI/Atlas_N_Resource/Icon/Pet/Pet_Portrait/Icon_Item_Pet_Fox04.png" alt="Candela" title="Luminous Empress Candela">
                    </div>
                    <div class="espirito-item" data-nome="Eighthorns Revenant Destructive Emperor" onclick="toggleEspirito(this)">
                        <img src="https://file.mir4global.com/xdraco-thumb/Content/UI/Atlas_N_Resource/Icon/Pet/Pet_Portrait/Icon_Item_Pet_Undead01.png" alt="Destructive Emperor" title="Eighthorns Revenant Destructive Emperor">
                    </div>
                    <div class="espirito-item" data-nome="Tri-head Draconis" onclick="toggleEspirito(this)">
                        <img src="https://file.mir4global.com/xdraco-thumb/Content/UI/Atlas_N_Resource/Icon/Pet/Pet_Portrait/Icon_Item_Pet_Hydra01.png" alt="Draconis" title="Tri-head Draconis">
                    </div>
                    <div class="espirito-item" data-nome="Vagabond Cloud Sage" onclick="toggleEspirito(this)">
                        <img src="https://file.mir4global.com/xdraco-thumb/Content/UI/Atlas_N_Resource/Icon/Pet/Pet_Portrait/Icon_Item_Pet_Cat09.png" alt="Cloud Sage" title="Vagabond Cloud Sage">
                    </div>
                    <div class="espirito-item" data-nome="Fairy Dragon Goldflower" onclick="toggleEspirito(this)">
                        <img src="https://file.mir4global.com/xdraco-thumb/Content/UI/Atlas_N_Resource/Icon/Pet/Pet_Portrait/Icon_Item_Pet_Dragon12.png" alt="Goldflower" title="Fairy Dragon Goldflower">
                    </div>
                    <div class="espirito-item" data-nome="Small White Dragon Chunryu" onclick="toggleEspirito(this)">
                        <img src="https://file.mir4global.com/xdraco-thumb/Content/UI/Atlas_N_Resource/Icon/Pet/Pet_Portrait/Icon_Item_Pet_Dragon07.png" alt="Chunryu" title="Small White Dragon Chunryu">
                    </div>
                    <div class="espirito-item" data-nome="Firelord Balrokk" onclick="toggleEspirito(this)">
                        <img src="https://file.mir4global.com/xdraco-thumb/Content/UI/Atlas_N_Resource/Icon/Pet/Pet_Portrait/Icon_Item_Pet_DarkMen01.png" alt="Balrokk" title="Firelord Balrokk">
                    </div>
                    <div class="espirito-item" data-nome="Thunder Divine Dragon Toril" onclick="toggleEspirito(this)">
                        <img src="https://file.mir4global.com/xdraco-thumb/Content/UI/Atlas_N_Resource/Icon/Pet/Pet_Portrait/Icon_Item_Pet_Dragon10.png" alt="Toril" title="Thunder Divine Dragon Toril">
                    </div>
                    <div class="espirito-item" data-nome="Lightning Force Dragon Zeon" onclick="toggleEspirito(this)">
                        <img src="https://file.mir4global.com/xdraco-thumb/Content/UI/Atlas_N_Resource/Icon/Pet/Pet_Portrait/Icon_Item_Pet_Dragon11.png" alt="Zeon" title="Lightning Force Dragon Zeon">
                    </div>
                    <div class="espirito-item" data-nome="Mystic Meow Haeryeong" onclick="toggleEspirito(this)">
                        <img src="https://file.mir4global.com/xdraco-thumb/Content/UI/Atlas_N_Resource/Icon/Pet/Pet_Portrait/Icon_Item_Pet_Cat07.png" alt="Haeryeong" title="Mystic Meow Haeryeong">
                    </div>
                    <div class="espirito-item" data-nome="Celestial Guardian Eldra" onclick="toggleEspirito(this)">
                        <img src="https://file.mir4global.com/xdraco-thumb/Content/UI/Atlas_N_Resource/Icon/Pet/Pet_Portrait/Icon_Item_Pet_Dragon13.png" alt="Eldra" title="Celestial Guardian Eldra">
                    </div>
                    <div class="espirito-item" data-nome="Lookout Luna" onclick="toggleEspirito(this)">
                        <img src="https://file.mir4global.com/xdraco-thumb/Content/UI/Atlas_N_Resource/Icon/Pet/Pet_Portrait/Icon_Item_Pet_Cat08.png" alt="Luna" title="Lookout Luna">
                    </div>
                    <div class="espirito-item" data-nome="Desert Lord Pharaoh" onclick="toggleEspirito(this)">
                        <img src="https://file.mir4global.com/live_global/community/editor/2023/05/263894a80f9efcc07d5a58fe89775b27.png" alt="Pharaoh" title="Desert Lord Pharaoh">
                    </div>
                    <div class="espirito-item" data-nome="Demon Bull King of Inferno" onclick="toggleEspirito(this)">
                        <img src="https://file.mir4global.com/xdraco-thumb/Content/UI/Atlas_N_Resource/Icon/Pet/Pet_Portrait/Icon_Item_Pet_Uma01.png" alt="Demon Bull King" title="Demon Bull King of Inferno">
                    </div>
                </div>
                
                <h4 style="color: #9f7aea; margin: 20px 0 10px;">Esp√≠ritos √âpicos (Grade 4) - 23 pets</h4>
                <div class="espiritos-grid" id="espiritos-epicos">
                    <!-- √âpicos Grade 4 - Lista completa da API mir4collection -->
                    <div class="espirito-item" data-nome="Golden Bird Suparna" onclick="toggleEspirito(this)">
                        <img src="https://file.mir4global.com/xdraco-thumb/Content/UI/Atlas_N_Resource/Icon/Pet/Pet_Portrait/Icon_Item_Pet_Peacock01.png" alt="Suparna" title="Golden Bird Suparna">
                    </div>
                    <div class="espirito-item" data-nome="Absolute Beauty Whaley" onclick="toggleEspirito(this)">
                        <img src="https://file.mir4global.com/xdraco-thumb/Content/UI/Atlas_N_Resource/Icon/Pet/Pet_Portrait/Icon_Item_Pet_Whale01.png" alt="Whaley" title="Absolute Beauty Whaley">
                    </div>
                    <div class="espirito-item" data-nome="White Peacock Crystalglass" onclick="toggleEspirito(this)">
                        <img src="https://file.mir4global.com/xdraco-thumb/Content/UI/Atlas_N_Resource/Icon/Pet/Pet_Portrait/Icon_Item_Pet_Peacock02.png" alt="Crystalglass" title="White Peacock Crystalglass">
                    </div>
                    <div class="espirito-item" data-nome="Lucky Cat Luckster" onclick="toggleEspirito(this)">
                        <img src="https://file.mir4global.com/xdraco-thumb/Content/UI/Atlas_N_Resource/Icon/Pet/Pet_Portrait/Icon_Item_Pet_Cat02.png" alt="Luckster" title="Lucky Cat Luckster">
                    </div>
                    <div class="espirito-item" data-nome="Gem Mania Shaoshao" onclick="toggleEspirito(this)">
                        <img src="https://file.mir4global.com/xdraco-thumb/Content/UI/Atlas_N_Resource/Icon/Pet/Pet_Portrait/Icon_Item_Pet_Dragon02.png" alt="Shaoshao" title="Gem Mania Shaoshao">
                    </div>
                    <div class="espirito-item" data-nome="Assassin Nyanja" onclick="toggleEspirito(this)">
                        <img src="https://file.mir4global.com/xdraco-thumb/Content/UI/Atlas_N_Resource/Icon/Pet/Pet_Portrait/Icon_Item_Pet_Cat04.png" alt="Nyanja" title="Assassin Nyanja">
                    </div>
                    <div class="espirito-item" data-nome="Thunder Beast Baratan" onclick="toggleEspirito(this)">
                        <img src="https://file.mir4global.com/xdraco-thumb/Content/UI/Atlas_N_Resource/Icon/Pet/Pet_Portrait/Icon_Item_Pet_ElecDevil01.png" alt="Baratan" title="Thunder Beast Baratan">
                    </div>
                    <div class="espirito-item" data-nome="Glowing Gem Sparkler" onclick="toggleEspirito(this)">
                        <img src="https://file.mir4global.com/xdraco-thumb/Content/UI/Atlas_N_Resource/Icon/Pet/Pet_Portrait/Icon_Item_Pet_Insect02.png" alt="Sparkler" title="Glowing Gem Sparkler">
                    </div>
                    <div class="espirito-item" data-nome="Fire Devil Flamehorn" onclick="toggleEspirito(this)">
                        <img src="https://file.mir4global.com/xdraco-thumb/Content/UI/Atlas_N_Resource/Icon/Pet/Pet_Portrait/Icon_Item_Pet_FireDevil01.png" alt="Flamehorn" title="Fire Devil Flamehorn">
                    </div>
                    <div class="espirito-item" data-nome="Soul Harvester Reaper" onclick="toggleEspirito(this)">
                        <img src="https://file.mir4global.com/xdraco-thumb/Content/UI/Atlas_N_Resource/Icon/Pet/Pet_Portrait/Icon_Item_Pet_Reaper01.png" alt="Reaper" title="Soul Harvester Reaper">
                    </div>
                    <div class="espirito-item" data-nome="Flame Hellborn Biyoho" onclick="toggleEspirito(this)">
                        <img src="https://file.mir4global.com/xdraco-thumb/Content/UI/Atlas_N_Resource/Icon/Pet/Pet_Portrait/Icon_Item_Pet_Fox03.png" alt="Biyoho" title="Flame Hellborn Biyoho">
                    </div>
                    <div class="espirito-item" data-nome="Leocrat Khun" onclick="toggleEspirito(this)">
                        <img src="https://file.mir4global.com/xdraco-thumb/Content/UI/Atlas_N_Resource/Icon/Pet/Pet_Portrait/Icon_Item_Pet_Lion01.png" alt="Khun" title="Leocrat Khun">
                    </div>
                    <div class="espirito-item" data-nome="Brutal Lionheart Koiga" onclick="toggleEspirito(this)">
                        <img src="https://file.mir4global.com/xdraco-thumb/Content/UI/Atlas_N_Resource/Icon/Pet/Pet_Portrait/Icon_Item_Pet_Monkey02.png" alt="Koiga" title="Brutal Lionheart Koiga">
                    </div>
                    <div class="espirito-item" data-nome="Dark Ice Demon Nerr" onclick="toggleEspirito(this)">
                        <img src="https://file.mir4global.com/xdraco-thumb/Content/UI/Atlas_N_Resource/Icon/Pet/Pet_Portrait/Icon_Item_Pet_Goat01.png" alt="Nerr" title="Dark Ice Demon Nerr">
                    </div>
                    <div class="espirito-item" data-nome="Radiance Dragon Mir" onclick="toggleEspirito(this)">
                        <img src="https://file.mir4global.com/xdraco-thumb/Content/UI/Atlas_N_Resource/Icon/Pet/Pet_Portrait/Icon_Item_Pet_Dragon04.png" alt="Mir" title="Radiance Dragon Mir">
                    </div>
                    <div class="espirito-item" data-nome="Verdant Watchkeeper Gargas" onclick="toggleEspirito(this)">
                        <img src="https://file.mir4global.com/xdraco-thumb/Content/UI/Atlas_N_Resource/Icon/Pet/Pet_Portrait/Icon_Item_Pet_Eagle02.png" alt="Gargas" title="Verdant Watchkeeper Gargas">
                    </div>
                    <div class="espirito-item" data-nome="Spring Messenger Yobi" onclick="toggleEspirito(this)">
                        <img src="https://file.mir4global.com/xdraco-thumb/Content/UI/Atlas_N_Resource/Icon/Pet/Pet_Portrait/Icon_Item_Pet_Dragon05.png" alt="Yobi" title="Spring Messenger Yobi">
                    </div>
                    <div class="espirito-item" data-nome="Dark Cloud Dragon Poipoi" onclick="toggleEspirito(this)">
                        <img src="https://file.mir4global.com/xdraco-thumb/Content/UI/Atlas_N_Resource/Icon/Pet/Pet_Portrait/Icon_Item_Pet_Dragon06.png" alt="Poipoi" title="Dark Cloud Dragon Poipoi">
                    </div>
                    <div class="espirito-item" data-nome="Redhorn Komet" onclick="toggleEspirito(this)">
                        <img src="https://file.mir4global.com/xdraco-thumb/Content/UI/Atlas_N_Resource/Icon/Pet/Pet_Portrait/Icon_Item_Pet_Skeleton02.png" alt="Komet" title="Redhorn Komet">
                    </div>
                    <div class="espirito-item" data-nome="Dark Assassin Zakhan" onclick="toggleEspirito(this)">
                        <img src="https://file.mir4global.com/xdraco-thumb/Content/UI/Atlas_N_Resource/Icon/Pet/Pet_Portrait/Icon_Item_Pet_Bat02.png" alt="Zakhan" title="Dark Assassin Zakhan">
                    </div>
                    <div class="espirito-item" data-nome="Blue Baron Mantata" onclick="toggleEspirito(this)">
                        <img src="https://file.mir4global.com/xdraco-thumb/Content/UI/Atlas_N_Resource/Icon/Pet/Pet_Portrait/Icon_Item_Pet_Cat06.png" alt="Mantata" title="Blue Baron Mantata">
                    </div>
                    <div class="espirito-item" data-nome="Desert Sage Woosa" onclick="toggleEspirito(this)">
                        <img src="https://file.mir4global.com/xdraco-thumb/Content/UI/Atlas_N_Resource/Icon/Pet/Pet_Portrait/Icon_Item_Pet_Rabbit02.png" alt="Woosa" title="Desert Sage Woosa">
                    </div>
                    <div class="espirito-item" data-nome="Jade Butterfly Visana" onclick="toggleEspirito(this)">
                        <img src="https://file.mir4global.com/xdraco-thumb/Content/UI/Atlas_N_Resource/Icon/Pet/Pet_Portrait/Icon_Item_Pet_Butterfly03.png" alt="Visana" title="Jade Butterfly Visana">
                    </div>
                </div>
                
                <div style="margin-top: 20px; display: flex; gap: 10px; justify-content: center;">
                    <button type="button" class="btn-limpar-modal" onclick="limparEspiritos()"><i class="fas fa-times"></i> Limpar Sele√ß√£o</button>
                    <button type="button" class="btn-aplicar-modal" onclick="fecharModalEspiritos()"><i class="fas fa-check"></i> Aplicar Filtros</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Status Avan√ßados -->
    <div id="modal-status" class="modal" onclick="fecharModalStatus()">
        <div class="modal-conteudo" onclick="event.stopPropagation()">
            <div class="modal-cabecalho">
                <h2><i class="fas fa-sliders-h"></i> Filtros de Status Avan√ßados</h2>
                <span class="fechar-modal" onclick="fecharModalStatus()">&times;</span>
            </div>
            <div class="modal-corpo">
                <p style="font-size: 0.9rem; color: #a0aec0; margin-bottom: 15px;">
                    Defina valores m√≠nimos para os status abaixo. Deixe em branco para ignorar.
                </p>
                
                <div class="modal-buscar">
                    <input type="text" id="busca-status" placeholder="Buscar status..." onkeyup="filtrarStatus()" 
                           style="width: 100%; padding: 10px; background: #2d3748; border: 1px solid #4a5568; color: white; border-radius: 5px;">
                </div>
                
                <div id="lista-status" style="max-height: 50vh; overflow-y: auto; padding-right: 10px; margin-top: 15px;">
                    {% for status in status_importantes %}
                        {% if not status.destaque %}
                        <div class="status-item" data-nome="{{ status.nome|lower }}" 
                             style="display: flex; justify-content: space-between; align-items: center; padding: 8px 0; border-bottom: 1px solid #4a5568;">
                            <div class="status-info">
                                <label style="font-size: 0.85rem; color: white;">{{ status.nome }}</label>
                            </div>
                            <div class="status-input">
                                <input type="number" id="status_{{ status.hash }}" 
                                       placeholder="0" 
                                       style="width: 100px; font-size: 0.9rem; padding: 6px 10px; background: #2d3748; border: 1px solid #4a5568; color: white; border-radius: 5px;"
                                       value="">
                            </div>
                        </div>
                        {% endif %}
                    {% endfor %}
                </div>
                
                <div class="modal-controles" style="display: flex; gap: 10px; margin-top: 20px;">
                    <button class="btn-modal btn-limpar" onclick="limparFiltrosStatus()" 
                            style="flex: 1; padding: 10px; background: #718096; color: white; border: none; border-radius: 5px; cursor: pointer;">
                        <i class="fas fa-trash-alt"></i> Limpar Todos
                    </button>
                    <button class="btn-modal btn-aplicar" onclick="fecharModalStatus()" 
                            style="flex: 1; padding: 10px; background: #4299e1; color: white; border: none; border-radius: 5px; cursor: pointer;">
                        <i class="fas fa-check"></i> Aplicar Filtros
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal de Filtro de Itens -->
    <div id="modal-itens" class="modal" onclick="fecharModalItens()">
        <div class="modal-conteudo" onclick="event.stopPropagation()">
            <div class="modal-cabecalho">
                <h2><i class="fas fa-box-open"></i> Filtro de Itens</h2>
                <span class="fechar-modal" onclick="fecharModalItens()">&times;</span>
            </div>
            <div class="modal-corpo">
                <p style="font-size: 0.9rem; color: #a0aec0; margin-bottom: 15px;">
                    Busque itens pelo nome e defina a quantidade m√≠nima. Deixe em branco para ignorar.
                </p>
                
                <div class="modal-buscar">
                    <input type="text" id="busca-item" placeholder="Buscar item..." onkeyup="filtrarItens()" 
                           style="width: 100%; padding: 10px; background: #2d3748; border: 1px solid #4a5568; color: white; border-radius: 5px;">
                </div>
                
                <div id="itens-selecionados" style="margin-top: 10px; display: flex; flex-wrap: wrap; gap: 5px;">
                    <!-- Itens selecionados aparecem aqui como tags -->
                </div>
                
                <div id="lista-itens" style="max-height: 40vh; overflow-y: auto; padding-right: 10px; margin-top: 15px;">
                    {% for item in itens_lista %}
                        <div class="item-filtro-item" data-nome="{{ item.nome|lower }}" data-hash="{{ item.hash }}"
                             style="display: none; justify-content: space-between; align-items: center; padding: 8px 0; border-bottom: 1px solid #4a5568; cursor: pointer;"
                             onclick="adicionarFiltroItem('{{ item.hash }}', '{{ item.nome }}')">
                            <div class="item-info" style="flex: 1;">
                                <label style="font-size: 0.85rem; color: white; cursor: pointer;">{{ item.nome }}</label>
                            </div>
                        </div>
                    {% endfor %}
                </div>
                
                <div id="itens-filtro-ativos" style="margin-top: 15px; border-top: 1px solid #4a5568; padding-top: 15px;">
                    <h4 style="color: #f6e05e; margin-bottom: 10px;"><i class="fas fa-filter"></i> Filtros Ativos</h4>
                    <div id="itens-filtro-lista" style="max-height: 25vh; overflow-y: auto;">
                        <!-- Itens com filtro ativo -->
                    </div>
                </div>
                
                <div class="modal-controles" style="display: flex; gap: 10px; margin-top: 20px;">
                    <button class="btn-modal btn-limpar" onclick="limparFiltrosItens()" 
                            style="flex: 1; padding: 10px; background: #718096; color: white; border: none; border-radius: 5px; cursor: pointer;">
                        <i class="fas fa-trash-alt"></i> Limpar Todos
                    </button>
                    <button class="btn-modal btn-aplicar" onclick="fecharModalItens()" 
                            style="flex: 1; padding: 10px; background: #38a169; color: white; border: none; border-radius: 5px; cursor: pointer;">
                        <i class="fas fa-check"></i> Aplicar Filtros
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Premium - Banner de Benef√≠cios -->
    <div id="modal-premium" class="modal" onclick="fecharModalPremium()">
        <div class="modal-conteudo modal-premium-banner" onclick="event.stopPropagation()">
            <div class="modal-cabecalho" style="background: linear-gradient(135deg, #F6E05E, #ECC94B); color: #1a202c;">
                <h2><i class="fas fa-crown"></i> MIR4 You Premium</h2>
                <span class="fechar-modal" onclick="fecharModalPremium()" style="color: #1a202c;">&times;</span>
            </div>
            <div class="modal-corpo" style="text-align: center;">
                <p style="font-size: 1.2rem; color: #f6e05e; margin-bottom: 20px;">
                    <strong>Desbloqueie todo o potencial da busca!</strong>
                </p>
                
                <div class="premium-beneficios">
                    <div class="beneficio-item">
                        <i class="fas fa-ghost"></i>
                        <span>Filtro de Esp√≠ritos</span>
                    </div>
                    <div class="beneficio-item">
                        <i class="fas fa-magic"></i>
                        <span>Filtro de Habilidades</span>
                    </div>
                    <div class="beneficio-item">
                        <i class="fas fa-sliders-h"></i>
                        <span>Filtros de Status</span>
                    </div>
                    <div class="beneficio-item">
                        <i class="fas fa-box-open"></i>
                        <span>Filtro de Itens</span>
                    </div>
                    <div class="beneficio-item">
                        <i class="fas fa-gem"></i>
                        <span>Filtros de Minera√ß√£o</span>
                    </div>
                    <div class="beneficio-item">
                        <i class="fas fa-balance-scale"></i>
                        <span>Itens Comercializ√°veis</span>
                    </div>
                    <div class="beneficio-item">
                        <i class="fas fa-dumbbell"></i>
                        <span>Filtro de Treinamento</span>
                    </div>
                    <div class="beneficio-item">
                        <i class="fas fa-gavel"></i>
                        <span>Ver Contas em Leil√£o</span>
                    </div>
                </div>
                
                <div class="premium-preco">
                    <span class="preco-valor">R$ 25</span>
                    <span class="preco-periodo">/m√™s</span>
                </div>
                
                <p style="color: #a0aec0; margin: 15px 0; font-size: 0.9rem;">
                    Pagamento via <strong style="color: #48bb78;">Pix</strong>
                </p>
                
                <a href="https://discord.gg/deSKDPNzAW" target="_blank" class="btn-discord-premium">
                    <i class="fab fa-discord"></i> Assinar via Discord
                </a>
                
                <p style="color: #718096; font-size: 0.75rem; margin-top: 15px;">
                    Entre no Discord e fale com um admin para ativar seu Premium
                </p>
            </div>
        </div>
    </div>

    <!-- Modal para Todos os Status -->
    <div id="modal-todos-status" class="modal" onclick="fecharModalTodosStatus()">
        <div class="modal-conteudo" onclick="event.stopPropagation()">
            <div class="modal-cabecalho">
                <h2><i class="fas fa-chart-bar"></i> Todos os Status</h2>
                <span class="fechar-modal" onclick="fecharModalTodosStatus()">&times;</span>
            </div>
            <div class="modal-corpo">
                <div class="modal-buscar">
                    <input type="text" id="buscar-status-modal" placeholder="Buscar status..."
                           style="width: 100%; padding: 10px; background: #2d3748; border: 1px solid #4a5568; color: white; border-radius: 5px;">
                </div>
                <div id="status-container" class="status-grid" style="margin-top: 15px;">
                    <!-- Status ser√£o carregados aqui -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- CONFIGURA√á√ïES GLOBAIS ---
        const ICONS_PATH = "{{ url_for('static', filename='icons/') }}";
        const isPremium = {{ 'true' if is_premium else 'false' }};
        let cacheTipo = 'completas'; // Come√ßa com teste
        let paginaAtual = 0;
        let todasContas = [];
        let filtrosAtuais = null;
        const LIMITE_POR_PAGINA = 10;
        let totalContasFiltradas = 0;
        let filtrosItensAtivos = {}; // {hash: {nome: string, qtd: number}}

        // Mapeamento de servidores por regi√£o
        const SERVIDORES = {
            "ASIA1": ["ASIA011", "ASIA012", "ASIA013", "ASIA014", "ASIA021", "ASIA022", "ASIA023", "ASIA024", "ASIA031", "ASIA032", "ASIA033", "ASIA041", "ASIA042", "ASIA043"],
            "ASIA2": ["ASIA051", "ASIA052", "ASIA053", "ASIA054", "ASIA061", "ASIA062", "ASIA063", "ASIA064", "ASIA071", "ASIA072", "ASIA073", "ASIA081", "ASIA082", "ASIA083"],
            "ASIA3": ["ASIA311", "ASIA312", "ASIA313", "ASIA314", "ASIA321", "ASIA322", "ASIA323", "ASIA324", "ASIA331", "ASIA332", "ASIA333", "ASIA341", "ASIA342", "ASIA343"],
            "ASIA4": ["ASIA351", "ASIA352", "ASIA353", "ASIA354", "ASIA361", "ASIA362", "ASIA363", "ASIA364", "ASIA371", "ASIA372", "ASIA373"],
            "INMENA1": ["INMENA011", "INMENA012", "INMENA013", "INMENA014", "INMENA021", "INMENA022", "INMENA023", "INMENA024"],
            "EU1": ["EU011", "EU012", "EU013", "EU014", "EU021", "EU022", "EU023", "EU024", "EU031", "EU032", "EU033", "EU034", "EU041", "EU042", "EU043"],
            "SA1": ["SA011", "SA012", "SA013", "SA014", "SA021", "SA022", "SA023", "SA031", "SA032", "SA033", "SA034", "SA041", "SA043", "SA044"],
            "SA2": ["SA051", "SA052", "SA053", "SA054", "SA061", "SA062", "SA064", "SA071", "SA072", "SA073", "SA081", "SA082", "SA083"],
            "NA1": ["NA011", "NA012", "NA013", "NA014", "NA021", "NA022", "NA023", "NA031", "NA032", "NA033", "NA034", "NA042", "NA043", "NA044"],
            "NA2": ["NA051", "NA052", "NA053", "NA054", "NA061", "NA062", "NA071", "NA072", "NA073", "NA074", "NA081", "NA082", "NA083", "NA084"]
        };

        // Fun√ß√£o para atualizar dropdown de servidores com base na regi√£o selecionada
        function atualizarServidores() {
            const regiao = document.getElementById('regiao').value;
            const servidorSelect = document.getElementById('servidor');
            
            // Limpar op√ß√µes atuais
            servidorSelect.innerHTML = '<option value="">Todos</option>';
            
            // Se uma regi√£o foi selecionada, adicionar os servidores dela
            if (regiao && SERVIDORES[regiao]) {
                SERVIDORES[regiao].forEach(servidor => {
                    const option = document.createElement('option');
                    option.value = servidor;
                    option.textContent = servidor;
                    servidorSelect.appendChild(option);
                });
            }
        }

        // --- INICIALIZA√á√ÉO ---
        document.addEventListener('DOMContentLoaded', function() {
            // Listener para fechar modais com ESC
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    // Fechar todos os modais abertos
                    const modais = document.querySelectorAll('.modal');
                    modais.forEach(modal => {
                        if (modal.style.display === 'block' || modal.style.display === 'flex') {
                            modal.style.display = 'none';
                            modal.style.opacity = '0';
                        }
                    });
                    document.body.style.overflow = 'auto';
                    
                    // Fechar mini-dropdowns
                    const dropdowns = document.querySelectorAll('.mini-dropdown-content.show');
                    dropdowns.forEach(dd => dd.classList.remove('show'));
                }
            });
            
            // Verificar cache e carregar vitrine automaticamente
            verificarStatusCache().then(data => {
                if (data && (data.tem_cache_completo || data.tem_cache_teste)) {
                    // Seleciona o melhor cache dispon√≠vel
                    if (data.tem_cache_completo && data.total_completo > 0) {
                        selecionarCache('completas');
                    } else if (data.tem_cache_teste && data.total_teste > 0) {
                        selecionarCache('teste');
                    }
                }
                // Carregar vitrine automaticamente (contas mais fortes para mais fracas)
                setTimeout(() => {
                    buscarContas();
                }, 300);
            }).catch(() => {
                // Se n√£o conseguir verificar cache, carregar mesmo assim
                setTimeout(() => {
                    buscarContas();
                }, 300);
            });
        });

        // --- FUN√á√ïES DO MODAL PREMIUM ---
        function abrirModalPremium() {
            const modal = document.getElementById('modal-premium');
            modal.style.display = 'block';
            setTimeout(() => {
                modal.style.opacity = '1';
            }, 10);
        }
        
        function fecharModalPremium() {
            const modal = document.getElementById('modal-premium');
            modal.style.opacity = '0';
            setTimeout(() => {
                modal.style.display = 'none';
            }, 300);
        }

        // --- FUN√á√ïES DO MODAL ---
        function abrirModalStatus(event) {
            if (event) {
                event.preventDefault();
                event.stopPropagation();
            }
            
            const modal = document.getElementById('modal-status');
            modal.style.display = 'block';
            setTimeout(() => {
                modal.style.opacity = '1';
            }, 10);
            
            // Focar no campo de busca
            setTimeout(() => {
                document.getElementById('busca-status')?.focus();
            }, 50);
        }

        function fecharModalStatus() {
            const modal = document.getElementById('modal-status');
            modal.style.opacity = '0';
            setTimeout(() => {
                modal.style.display = 'none';
            }, 300);
        }
        
        // --- MODAL DE ESP√çRITOS ---
        let espiritosAtivos = new Set();
        const MAX_ESPIRITOS = 13;
        
        // Fun√ß√£o para remover acentos de strings
        function removerAcentos(str) {
            return str.normalize('NFD').replace(/[\u0300-\u036f]/g, '').toLowerCase();
        }
        
        function abrirModalEspiritos(event) {
            if (event) {
                event.preventDefault();
                event.stopPropagation();
            }
            const modal = document.getElementById('modal-espiritos');
            modal.style.display = 'block';
            setTimeout(() => {
                modal.style.opacity = '1';
            }, 10);
        }
        
        function fecharModalEspiritos() {
            const modal = document.getElementById('modal-espiritos');
            modal.style.opacity = '0';
            setTimeout(() => {
                modal.style.display = 'none';
            }, 300);
            atualizarCountEspiritos();
        }
        
        function toggleEspirito(el) {
            const nome = el.getAttribute('data-nome');
            
            if (el.classList.contains('selected')) {
                el.classList.remove('selected');
                espiritosAtivos.delete(nome);
            } else {
                if (espiritosAtivos.size >= MAX_ESPIRITOS) {
                    mostrarNotificacao(`M√°ximo de ${MAX_ESPIRITOS} esp√≠ritos selecionados`, 'warning');
                    return;
                }
                el.classList.add('selected');
                espiritosAtivos.add(nome);
            }
            
            atualizarCountEspiritos();
        }
        
        function limparEspiritos() {
            espiritosAtivos.clear();
            document.querySelectorAll('.espirito-item.selected').forEach(el => {
                el.classList.remove('selected');
            });
            atualizarCountEspiritos();
        }
        
        function atualizarCountEspiritos() {
            const countEl = document.getElementById('count-espiritos');
            if (countEl) {
                countEl.textContent = espiritosAtivos.size;
                countEl.classList.toggle('has-value', espiritosAtivos.size > 0);
            }
        }
        
        // --- MODAL DE HABILIDADES ---
        // Estrutura: { classe: { skillIdx: 'epica'|'lendaria' } }
        let skillsAtivas = {};
        let classeSkillAtual = '';
        
        const CLASSE_PARA_PASTA = {
            "1": "guerreiro",
            "2": "maga",
            "3": "taoista",
            "4": "lanceiro",
            "5": "arqueira",
            "6": "soturna"
        };
        
        function abrirModalHabilidades(event) {
            if (event) {
                event.preventDefault();
                event.stopPropagation();
            }
            const modal = document.getElementById('modal-habilidades');
            modal.style.display = 'block';
            setTimeout(() => {
                modal.style.opacity = '1';
            }, 10);
        }
        
        function fecharModalHabilidades() {
            const modal = document.getElementById('modal-habilidades');
            modal.style.opacity = '0';
            setTimeout(() => {
                modal.style.display = 'none';
            }, 300);
            atualizarCountSkills();
        }
        
        function carregarSkillsClasse() {
            const classeId = document.getElementById('skill-classe').value;
            const container = document.getElementById('skills-container');
            
            if (!classeId) {
                container.innerHTML = '<p style="color: #718096; text-align: center; width: 100%;">Selecione uma classe acima para ver as habilidades</p>';
                return;
            }
            
            classeSkillAtual = classeId;
            const pasta = CLASSE_PARA_PASTA[classeId];
            
            // Inicializar se n√£o existir
            if (!skillsAtivas[classeId]) {
                skillsAtivas[classeId] = {};
            }
            
            let html = '';
            for (let i = 1; i <= 13; i++) {
                const estado = skillsAtivas[classeId][i] || '';
                const classeCSS = estado ? estado : '';
                html += `
                    <div class="skill-item ${classeCSS}" data-idx="${i}" onclick="toggleSkill(${i})">
                        <img src="/static/skills/${pasta}${i}.png" alt="Skill ${i}" title="Habilidade ${i}">
                    </div>
                `;
            }
            
            container.innerHTML = html;
        }
        
        function toggleSkill(idx) {
            if (!classeSkillAtual) return;
            
            if (!skillsAtivas[classeSkillAtual]) {
                skillsAtivas[classeSkillAtual] = {};
            }
            
            const atual = skillsAtivas[classeSkillAtual][idx] || '';
            const skillEl = document.querySelector(`.skill-item[data-idx="${idx}"]`);
            
            // Ciclo: nada -> epica -> lendaria -> nada
            if (atual === '') {
                skillsAtivas[classeSkillAtual][idx] = 'epica';
                skillEl.classList.remove('lendaria');
                skillEl.classList.add('epica');
            } else if (atual === 'epica') {
                skillsAtivas[classeSkillAtual][idx] = 'lendaria';
                skillEl.classList.remove('epica');
                skillEl.classList.add('lendaria');
            } else {
                delete skillsAtivas[classeSkillAtual][idx];
                skillEl.classList.remove('epica', 'lendaria');
            }
            
            atualizarCountSkills();
        }
        
        function limparSkills() {
            skillsAtivas = {};
            classeSkillAtual = '';
            document.getElementById('skill-classe').value = '';
            document.getElementById('skills-container').innerHTML = '<p style="color: #718096; text-align: center; width: 100%;">Selecione uma classe acima para ver as habilidades</p>';
            atualizarCountSkills();
        }
        
        function atualizarCountSkills() {
            let total = 0;
            for (const classe in skillsAtivas) {
                total += Object.keys(skillsAtivas[classe]).length;
            }
            
            const countEl = document.getElementById('count-skills');
            if (countEl) {
                countEl.textContent = total;
                countEl.classList.toggle('has-value', total > 0);
            }
        }
        
        function getSkillsFiltro() {
            // Retorna array de { classe, idx, nivel } para enviar ao backend
            const filtros = [];
            for (const classe in skillsAtivas) {
                for (const idx in skillsAtivas[classe]) {
                    const tipo = skillsAtivas[classe][idx];
                    // epica = n√≠vel 8 ou 9, lendaria = n√≠vel 10
                    const nivelMin = tipo === 'lendaria' ? 10 : 8;
                    filtros.push({ classe, idx: parseInt(idx), nivelMin, tipo });
                }
            }
            return filtros;
        }

        // Fun√ß√£o para remover acentos
        function removerAcentos(str) {
            return str.normalize('NFD').replace(/[\u0300-\u036f]/g, '');
        }
        
        function filtrarStatus() {
            const buscaOriginal = document.getElementById('busca-status')?.value.toLowerCase() || '';
            const busca = removerAcentos(buscaOriginal);
            const items = document.querySelectorAll('#lista-status .status-item');
            
            items.forEach(item => {
                const nome = item.getAttribute('data-nome');
                const nomeNormalizado = removerAcentos(nome);
                if (nomeNormalizado.includes(busca)) {
                    item.style.display = 'flex';
                } else {
                    item.style.display = 'none';
                }
            });
        }

        function limparFiltrosStatus() {
            if (confirm('Limpar todos os filtros de status?')) {
                document.querySelectorAll('#lista-status input').forEach(input => {
                    input.value = '';
                });
                
                const aceleramento = document.getElementById('status_aceleramento');
                const aconegro = document.getElementById('status_aconegro');
                const minaMin = document.getElementById('mina_min');
                
                if (aceleramento) aceleramento.value = '';
                if (aconegro) aconegro.value = '';
                if (minaMin) minaMin.value = '';
            }
        }

        // --- FUN√á√ïES DO MODAL DE ITENS ---
        function abrirModalItens(event) {
            if (event) {
                event.preventDefault();
                event.stopPropagation();
            }
            
            const modal = document.getElementById('modal-itens');
            modal.style.display = 'block';
            setTimeout(() => {
                modal.style.opacity = '1';
            }, 10);
            
            // Focar no campo de busca
            setTimeout(() => {
                document.getElementById('busca-item')?.focus();
            }, 50);
            
            // Atualizar lista de filtros ativos
            atualizarListaFiltrosItens();
        }

        function fecharModalItens() {
            const modal = document.getElementById('modal-itens');
            modal.style.opacity = '0';
            setTimeout(() => {
                modal.style.display = 'none';
            }, 300);
        }

        function filtrarItens() {
            const buscaOriginal = document.getElementById('busca-item')?.value || '';
            const busca = removerAcentos(buscaOriginal.toLowerCase().trim());
            const items = document.querySelectorAll('#lista-itens .item-filtro-item');
            
            let encontrados = 0;
            const maxResultados = 50; // Limitar resultados para performance
            
            items.forEach(item => {
                if (busca.length < 1) {
                    item.style.display = 'none';
                    return;
                }
                
                const nomeOriginal = item.getAttribute('data-nome') || '';
                const nomeSemAcento = removerAcentos(nomeOriginal);
                
                if (encontrados < maxResultados && nomeSemAcento.includes(busca)) {
                    item.style.display = 'flex';
                    encontrados++;
                } else {
                    item.style.display = 'none';
                }
            });
        }

        function adicionarFiltroItem(hash, nome) {
            // Se j√° existe, n√£o adicionar novamente
            if (filtrosItensAtivos[hash]) {
                mostrarNotificacao('Este item j√° est√° na lista de filtros', 'warning');
                return;
            }
            
            // Adicionar com quantidade padr√£o 1
            filtrosItensAtivos[hash] = { nome: nome, qtd: 1 };
            
            // Limpar busca
            document.getElementById('busca-item').value = '';
            filtrarItens();
            
            // Atualizar lista
            atualizarListaFiltrosItens();
            
            mostrarNotificacao(`"${nome}" adicionado aos filtros`, 'success');
        }

        function removerFiltroItem(hash) {
            const nome = filtrosItensAtivos[hash]?.nome || '';
            delete filtrosItensAtivos[hash];
            atualizarListaFiltrosItens();
            mostrarNotificacao(`"${nome}" removido dos filtros`, 'success');
        }

        function atualizarQuantidadeItem(hash, qtd) {
            if (filtrosItensAtivos[hash]) {
                filtrosItensAtivos[hash].qtd = parseInt(qtd) || 1;
            }
        }

        function atualizarListaFiltrosItens() {
            const container = document.getElementById('itens-filtro-lista');
            
            if (Object.keys(filtrosItensAtivos).length === 0) {
                container.innerHTML = '<p style="color: #a0aec0; font-style: italic;">Nenhum filtro de item ativo. Busque e clique em um item para adicionar.</p>';
                return;
            }
            
            let html = '';
            for (const [hash, data] of Object.entries(filtrosItensAtivos)) {
                html += `
                    <div class="item-filtro-ativo" style="display: flex; align-items: center; gap: 10px; padding: 8px 0; border-bottom: 1px solid #4a5568;">
                        <div style="flex: 1; color: white; font-size: 0.85rem;" title="${data.nome}">${data.nome}</div>
                        <div style="display: flex; align-items: center; gap: 5px;">
                            <label style="color: #a0aec0; font-size: 0.8rem;">M√≠n:</label>
                            <input type="number" value="${data.qtd}" min="1" 
                                   style="width: 60px; padding: 5px; background: #2d3748; border: 1px solid #4a5568; color: white; border-radius: 3px;"
                                   onchange="atualizarQuantidadeItem('${hash}', this.value)">
                        </div>
                        <button onclick="removerFiltroItem('${hash}')" 
                                style="background: #e53e3e; color: white; border: none; padding: 5px 10px; border-radius: 3px; cursor: pointer;">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                `;
            }
            
            container.innerHTML = html;
        }

        function limparFiltrosItens() {
            filtrosItensAtivos = {};
            atualizarListaFiltrosItens();
            mostrarNotificacao('Filtros de itens limpos', 'success');
        }

        // --- FUN√á√ïES DO MODAL DE TODOS OS STATUS ---
        function abrirModalTodosStatus(event) {
            event.stopPropagation();
            
            try {
                const statsStr = event.currentTarget.getAttribute('data-stats');
                if (!statsStr) return;
                
                const stats = JSON.parse(statsStr);
                preencherModalStatus(stats);
                
                const modal = document.getElementById('modal-todos-status');
                modal.style.display = 'block';
                setTimeout(() => {
                    modal.style.opacity = '1';
                }, 10);
                
                setTimeout(() => {
                    const inputBusca = document.getElementById('buscar-status-modal');
                    if (inputBusca) {
                        inputBusca.focus();
                        // Adicionar listener de busca
                        inputBusca.oninput = function() {
                            filtrarStatusNoModal(this.value);
                        };
                    }
                }, 50);
                
            } catch (error) {
                console.error('Erro ao abrir modal de status:', error);
                mostrarNotificacao('Erro ao carregar status', 'error');
            }
        }
        
        function filtrarStatusNoModal(termo) {
            const container = document.getElementById('status-container');
            const itens = container.querySelectorAll('.status-item-modal');
            const termoNormalizado = removerAcentos(termo.toLowerCase().trim());
            
            itens.forEach(item => {
                const nomeEl = item.querySelector('.status-name-modal');
                const nome = nomeEl ? nomeEl.textContent.toLowerCase() : '';
                const nomeNormalizado = removerAcentos(nome);
                
                if (termoNormalizado === '' || nomeNormalizado.includes(termoNormalizado)) {
                    item.style.display = 'flex';
                } else {
                    item.style.display = 'none';
                }
            });
        }

        function fecharModalTodosStatus() {
            const modal = document.getElementById('modal-todos-status');
            modal.style.opacity = '0';
            setTimeout(() => {
                modal.style.display = 'none';
                document.getElementById('buscar-status-modal').value = '';
            }, 300);
        }

        function preencherModalStatus(stats) {
            const container = document.getElementById('status-container');
            container.innerHTML = '';
            
            // Garantir que stats seja um array
            let statsArray = stats;
            if (!Array.isArray(stats)) {
                if (stats && typeof stats === 'object') {
                    // Se for um objeto, tentar extrair como array
                    statsArray = stats.lists || stats.data || Object.values(stats);
                } else {
                    statsArray = [];
                }
            }
            
            if (!statsArray || statsArray.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px 20px; color: #a0aec0;">
                        <i class="fas fa-info-circle"></i>
                        <p>Nenhum status dispon√≠vel para esta conta.</p>
                    </div>
                `;
                return;
            }
            
            // Ordenar por nome
            const statsOrdenados = [...statsArray].sort((a, b) => 
                a.statName?.localeCompare(b.statName || '') || 0
            );
            
            statsOrdenados.forEach(stat => {
                const div = document.createElement('div');
                div.className = 'status-item-modal';
                div.style.cssText = 'display: flex; align-items: center; padding: 10px; border-bottom: 1px solid #4a5568;';
                
                const valorFormatado = formatarValorStatus(stat.statValue || '0');
                
                div.innerHTML = `
                    <div class="status-icon-modal" style="margin-right: 15px;">
                        ${stat.iconPath ? 
                            `<img src="${stat.iconPath}" alt="${stat.statName}" style="width: 32px; height: 32px;">` : 
                            `<i class="fas fa-chart-line" style="font-size: 24px; color: #4299e1;"></i>`
                        }
                    </div>
                    <div class="status-info-modal" style="flex: 1;">
                        <div class="status-name-modal" title="${stat.statName || ''}" style="color: white; font-size: 0.9rem;">
                            ${stat.statName || 'Status'}
                        </div>
                        <div class="status-value-modal" style="color: #f6e05e; font-weight: bold; font-size: 1rem;">
                            ${valorFormatado}
                        </div>
                    </div>
                `;
                
                container.appendChild(div);
            });
        }

        function formatarValorStatus(valor) {
            if (!valor || valor === 'null' || valor === 'undefined' || valor === '') {
                return '0';
            }
            
            if (valor.toString().includes('%')) {
                return valor.toString();
            }
            
            let numero = valor.toString().replace(/,/g, '');
            if (numero.includes(',') && !numero.includes('.')) {
                numero = numero.replace(',', '.');
            }
            
            const num = parseFloat(numero);
            if (isNaN(num)) {
                return valor.toString();
            }
            
            if (num % 1 === 0) {
                return Math.round(num).toLocaleString('pt-BR');
            }
            
            if (num >= 1000000000) {
                return (num / 1000000000).toFixed(2) + 'B';
            } else if (num >= 1000000) {
                return (num / 1000000).toFixed(2) + 'M';
            } else if (num >= 1000) {
                return (num / 1000).toFixed(1) + 'K';
            }
            
            return num.toFixed(2);
        }

        function mostrarNotificacao(mensagem, tipo = 'info') {
            const notifAnterior = document.querySelector('.notification');
            if (notifAnterior) {
                notifAnterior.remove();
            }
            
            const notificacao = document.createElement('div');
            notificacao.className = `notification ${tipo}`;
            
            let icone = 'info-circle';
            if (tipo === 'success') icone = 'check-circle';
            if (tipo === 'error') icone = 'exclamation-circle';
            if (tipo === 'warning') icone = 'exclamation-triangle';
            
            notificacao.innerHTML = `
                <i class="fas fa-${icone}"></i>
                <span>${mensagem}</span>
            `;
            
            document.body.appendChild(notificacao);
            
            setTimeout(() => {
                notificacao.classList.add('show');
            }, 10);
            
            setTimeout(() => {
                notificacao.classList.remove('show');
                setTimeout(() => {
                    if (notificacao.parentNode) {
                        notificacao.remove();
                    }
                }, 300);
            }, 4000);
        }

        // --- FUN√á√ïES DE FORMATA√á√ÉO ---
        function formatarNumero(num) {
            if (num === undefined || num === null) return "0";
            if (typeof num === 'string') {
                num = parseFloat(num.replace(/,/g, ''));
            }
            if (isNaN(num)) return "0";
            
            if (num >= 1000) {
                return num.toLocaleString('pt-BR', {
                    minimumFractionDigits: 0,
                    maximumFractionDigits: 0
                });
            }
            
            if (num % 1 !== 0) {
                return num.toFixed(1).replace('.', ',');
            }
            
            return num.toString();
        }

        function formatarPorcentagem(num) {
            if (num === undefined || num === null) return "0%";
            if (typeof num === 'string') {
                num = parseFloat(num.replace(/,/g, ''));
            }
            if (isNaN(num)) return "0%";
            return num.toFixed(1) + "%";
        }

        // --- FUN√á√ÉO AUXILIAR PARA RENDERIZAR ITENS ---
        function renderItemIcon(item) {
            if (!item) {
                return '<div class="item-circle" style="border-style: dashed; border-color: #444; background: rgba(0,0,0,0.3);"><i class="fas fa-question"></i></div>';
            }
            
            const gradeClass = `grade-${item.grade || 1}`;
            const enhanceHtml = item.enhance > 0 ? `<div class="badge-enhance">+${item.enhance}</div>` : '';
            
            // Tier em Romano
            const tiers = ["", "T1", "T2", "T3", "T4", "T5"];
            const tierHtml = item.tier > 0 ? `<div class="badge-tier">${tiers[item.tier] || 'I'}</div>` : '';
            
            // Trade - Agora usando imagem personalizada
            const tradeHtml = (isPremium && item.trade) ? `<div class="badge-trade" title="Item Negoci√°vel"></div>` : '';
            
            // Quantidade
            const countHtml = item.count > 1 ? `<div class="badge-count">${item.count}</div>` : '';

            // Se n√£o tiver imagem, usar √≠cone com fundo da raridade
            if (!item.img || item.img === '') {
                return `
                <div class="item-circle ${gradeClass} no-img" title="${item.name || ''}">
                    <i class="fas fa-box" style="color: rgba(255,255,255,0.8);"></i>
                    ${enhanceHtml}
                    ${tierHtml}
                    ${tradeHtml}
                    ${countHtml}
                </div>
                `;
            }
            

            // Com imagem - background da imagem
            return `
            <div class="item-circle ${gradeClass}" 
                 style="background-image: url('${item.img}'); background-size: contain; background-position: center; background-repeat: no-repeat;" 
                 title="${item.name || ''}">
                ${enhanceHtml}
                ${tierHtml}
                ${tradeHtml}
                ${countHtml}
            </div>
            `;
        }

        // --- FUN√á√ÉO PARA RENDERIZAR ITENS ESPECIAIS (BILHETES, CRISTAIS, FRAGMENTOS) ---
        function renderSpecialItem(item) {
            if (!item) {
                return '<div class="item-circle" style="border-style: dashed; border-color: #444; background: rgba(0,0,0,0.3);"><i class="fas fa-question"></i></div>';
            }
            
            const gradeClass = `grade-${item.grade || 1}`;
            const countHtml = item.count > 1 ? `<div class="badge-count">${item.count}</div>` : '';
            
            // Se n√£o tiver imagem, usar √≠cone com fundo da raridade
            if (!item.img || item.img === '') {
                return `
                <div class="item-circle ${gradeClass} no-img" title="${item.name || ''}">
                    <i class="fas fa-box" style="color: rgba(255,255,255,0.8);"></i>
                    ${countHtml}
                </div>
                `;
            }
            
            // Com imagem
            return `
            <div class="item-circle ${gradeClass}" 
                 style="background-image: url('${item.img}');" 
                 title="${item.name || ''}">
                <div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: inherit; border-radius: 10px;"></div>
                ${countHtml}
            </div>
            `;
        }

        // Fun√ß√£o para ordenar itens especiais por raridade (√âpico > Raro > Incomum) e depois por nome
        function ordenarItensEspeciais(itens) {
            if (!itens || itens.length === 0) {
                return itens;
            }
            
            // Pesos de raridade
            const pesosRaridade = {
                '√âpico': 3,
                'Raro': 2,
                'Incomum': 1
            };
            
            return itens.sort((a, b) => {
                const nomeA = a.name || '';
                const nomeB = b.name || '';
                
                // Extrai a raridade da √∫ltima palavra do nome
                const raridadeA = nomeA.split(' ').pop();
                const raridadeB = nomeB.split(' ').pop();
                
                const pesoA = pesosRaridade[raridadeA] || 0;
                const pesoB = pesosRaridade[raridadeB] || 0;
                
                // Primeiro ordena por raridade (decrescente)
                if (pesoA !== pesoB) {
                    return pesoB - pesoA; // √âpico (3) vem antes de Raro (2)
                }
                
                // Se mesma raridade, ordena por nome
                return nomeA.localeCompare(nomeB);
            });
        }
        
        // --- FUN√á√ÉO PARA CALCULAR TEMPO RESTANTE DO LEIL√ÉO ---
        function calcularTempoRestanteLeilao(sealedTS) {
            if (!sealedTS || sealedTS === 0) return null;
            
            // Leil√µes no MIR4 duram 7 dias (168 horas) ap√≥s o sealedTS
            const DURACAO_LEILAO_SEGUNDOS = 7 * 24 * 60 * 60; // 7 dias em segundos
            const agora = Math.floor(Date.now() / 1000); // Timestamp atual em segundos
            const fimLeilao = sealedTS + DURACAO_LEILAO_SEGUNDOS;
            const segundosRestantes = fimLeilao - agora;
            
            if (segundosRestantes <= 0) {
                return { texto: 'Encerrado', expirado: true };
            }
            
            const dias = Math.floor(segundosRestantes / (24 * 60 * 60));
            const horas = Math.floor((segundosRestantes % (24 * 60 * 60)) / (60 * 60));
            const minutos = Math.floor((segundosRestantes % (60 * 60)) / 60);
            
            let texto = '';
            if (dias > 0) {
                texto = `${dias}d ${horas}h`;
            } else if (horas > 0) {
                texto = `${horas}h ${minutos}m`;
            } else {
                texto = `${minutos}m`;
            }
            
            return { texto, expirado: false, segundos: segundosRestantes };
        }
        
        // --- CONSTRUTOR DO CARD ---
        function criarCardConta(conta) {
            // L√≥gica de cores por faixa de poder
            let cardType = 'type-blue'; // Padr√£o para 239.999 pra baixo
            const poder = conta.powerScore;

            if (poder >= 400000) {
                cardType = 'type-gold';
            } else if (poder >= 249000) {
                cardType = 'type-red';
            } else {
                cardType = 'type-blue';
            }
            
            // Imagem da classe
            const imgClass = conta.class.imagem ? 
                `<img src="${ICONS_PATH}${conta.class.imagem}" alt="${conta.class.nome}" style="width: 60px; height: 60px;">` : 
                `<span style="font-size: 40px;">${conta.class.icone}</span>`;

            // Formata√ß√£o
           // Adicione estas vari√°veis na fun√ß√£o que monta o card:
// Adicione esta vari√°vel junto com as outras:
const phyAtk = formatarNumero(conta.ataque_fisico);
const magAtk = formatarNumero(conta.ataque_magico);
const crit = formatarNumero(conta.critico);
const precisao = formatarNumero(conta.precisao);
const atkHabilidade = formatarNumero(conta.atk_habilidade) + '%';
const evasao = formatarNumero(conta.evasao);
const miningBoost = formatarNumero(conta.aceleramento_mineracao) + '%';
const darksteelBoost = formatarNumero(conta.aumento_aconegro) + '%';
            const priceUsd = conta.price_brl ? `(R$ ${conta.price_brl.toLocaleString('pt-BR')})` : '($ --)';

            // Preparar dados
            const equips = Array.isArray(conta.equip) ? conta.equip : [];
            const spirits = Array.isArray(conta.spirit_list) ? conta.spirit_list : [];
            const skills = Array.isArray(conta.skills_list) ? conta.skills_list : [];
            const inventory = Array.isArray(conta.inven) ? conta.inven : [];
            const training = conta.training_details || { constituicao: 0, inner_force: [] };

            // Aba 0: Info Geral
            const tab0Content = `
                <div class="card-avatar-section">
                    <div class="class-name-vertical">${conta.class.nome}</div>
                    <div class="diamond-shape">
                        ${imgClass}
                    </div>
                </div>

                <div class="card-main-info">
                    <div class="card-level">LV. ${conta.level}</div>
                    <div class="card-power">${formatarNumero(conta.powerScore)}</div>
                    <div class="card-player-name">${conta.name}</div>
                </div>

                <div class="card-stats-grid">
                    <div class="stat-box">
                        <label>ATAQUE F√çSICO</label>
                        <span>${phyAtk}</span>
                    </div>
                    <div class="stat-box">
                        <label>ATAQUE M√ÅGICO</label>
                        <span>${magAtk}</span>
                    </div>
                    <div class="stat-box">
                        <label>Cr√≠tico</label>
                        <span>${crit}</span>
                    </div>
                    <div class="stat-box">
                        <label>[L] Esp√≠ritos</label>
                        <span>${conta.pets?.lendarios || 0}</span>
                    </div>
                    <div class="stat-box">
                        <label>[L] HABILIDADES</label>
                        <span>${conta.skills?.lendarias || 0}</span>
                    </div>
                    <div class="stat-box">
                        <label>Codex</label>
                        <span>${conta.codex || 0}</span>
                    </div>
					<div class="stat-box">
    <label>Precis√£o</label>
    <span>${precisao}</span>
</div>
<div class="stat-box">
    <label>aumento de atk de hab</label>
    <span>${atkHabilidade}</span>
</div>
<div class="stat-box">
    <label>Evas√£o</label>
    <span>${evasao}</span>
</div>
<div class="stat-box">
                        <label>Minera√ß√£o</label>
                        <span>${miningBoost}</span>
                    </div>
<div class="stat-box">
                        <label>A√ßo Negro</label>
                        <span>${darksteelBoost}</span>
                    </div>			
<div class="stat-box">
                        <label>Mina</label>
                        <span>${conta.mina || 0}</span>
                    </div>					
                </div>
				
				
            `;

            // Aba 1: Equip, Esp√≠ritos, Skills
            const equipsHtml = equips.length ? 
                equips.map(item => renderItemIcon(item)).join('') : 
                '<p style="grid-column:1/-1; text-align:center; font-size:0.8rem; color:#718096;">Sem equipamentos</p>';
                
            const spiritsHtml = spirits.length ? 
                spirits.map(item => renderItemIcon(item)).join('') : 
                '<p style="grid-column:1/-1; text-align:center; font-size:0.8rem; color:#718096;">Sem esp√≠ritos</p>';
                
            const skillsHtml = skills.length ? 
                skills.map(item => renderItemIcon(item)).join('') : 
                '<p style="grid-column:1/-1; text-align:center; font-size:0.8rem; color:#718096;">Sem habilidades</p>';

            const tab1Content = `
                <center><div class="section-title">Equipamentos</div>
                <div class="items-grid">${equipsHtml}</div>
                
                <div class="section-title">Esp√≠ritos</div>
                <div class="items-grid">${spiritsHtml}</div>

                <div class="section-title">Habilidades</div>
                <div class="items-grid no-tier">${skillsHtml}</div></center>
            `;

            // Aba 2: Treino
            let forceHtml = '';
            if (training.inner_force && training.inner_force.length > 0) {
                forceHtml = training.inner_force.map(f => `
                    <div class="stat-box">
                        <label>${f.name || 'For√ßa'}</label>
                        <span style="color: ${f.level >= 10 ? '#f6e05e' : '#fff'}">${f.level || 0}</span>
                    </div>
                `).join('');
            } else {
                forceHtml = '<p style="grid-column:1/-1; text-align:center; font-size:0.8rem; color:#718096;">Sem dados de for√ßa interna</p>';
            }

            const tab2Content = `
                <div style="margin-top: 20px;">
                    <div class="training-box">
                        <div class="training-lbl">CONSTITUI√á√ÉO</div>
                        <div class="training-val">${training.constituicao || conta.constituicao || 0}</div>
                    </div>
                    
                    
                    <div class="card-stats-grid" style="grid-template-columns: repeat(3, 1fr);">
                        ${forceHtml}
                    </div>
                     
                    <center><div class="training-lbl">Potencial</div><center>
                     <div class="training-box" style="padding: 5px;">
                        <div class="training-val" style="font-size: 1rem;">${conta.potencial || 0}</div>
                    </div>
                </div>
            `;

            // Aba 3: Invent√°rio - VERS√ÉO CORRIGIDA
            // Usar APENAS itens comercializ√°veis (trade=true)
            const itensComercializaveis = (conta.inven_all || []).filter(item => item.trade === true);
            const invenInicial = itensComercializaveis.slice(0, 12); // Primeiros 12 itens comercializ√°veis
            // IMPORTANTE: invenTotal deve vir do backend se dispon√≠vel
            const invenTotal = itensComercializaveis.length;

            // Verificar se temos mais itens do que os iniciais
            const temMaisItens = invenTotal > invenInicial.length;

            const invenHtml = invenInicial.length ? 
                invenInicial.map(item => renderItemIcon(item)).join('') : 
                '<div style="text-align:center; padding:20px; color:#718096; font-size:0.9rem;">Sem itens negoci√°veis</div>';

            const carregarMaisBtn3 = temMaisItens ? 
                `<button class="carregar-mais-btn" onclick="carregarMaisInventario('${conta.seq}')" 
                        id="carregar-mais-btn-${conta.seq}">
                    <i class="fas fa-plus"></i> Carregar mais itens (${invenTotal - invenInicial.length} restantes)
                </button>` : '';

            const tab3Content = `
                <center><div class="section-title">Top Itens Negoci√°veis</div></center>
                <div class="items-grid" id="inven-items-${conta.seq}">
                    ${invenHtml}
                </div>
                ${carregarMaisBtn3}
            `;

            // Aba 4: Bilhetes
            // HTML para Bilhetes (ordenar apenas por nome)
            const tickets = Array.isArray(conta.tickets) ? ordenarItensEspeciais(conta.tickets) : [];
            const ticketsHtml = tickets.length > 0 ? 
                tickets.map(item => renderSpecialItem(item)).join('') : 
                '<div style="text-align:center; padding:20px; color:#718096; font-size:0.9rem;">Sem bilhetes</div>';

            // HTML para Cristais (ordenar por raridade e nome)
            const crystals = Array.isArray(conta.crystals) ? ordenarItensEspeciais(conta.crystals) : [];
            const crystalsHtml = crystals.length > 0 ? 
                crystals.map(item => renderSpecialItem(item)).join('') : 
                '<div style="text-align:center; padding:20px; color:#718096; font-size:0.9rem;">Sem cristais</div>';

            // HTML para Fragmentos (ordenar por raridade e nome)
            const fragments = Array.isArray(conta.fragments) ? ordenarItensEspeciais(conta.fragments) : [];
            const fragmentsHtml = fragments.length > 0 ? 
                fragments.map(item => renderSpecialItem(item)).join('') : 
                '<div style="text-align:center; padding:20px; color:#718096; font-size:0.9rem;">Sem fragmentos</div>';
            
            // Badge din√¢mico baseado no has_active_bid (dados em tempo real do wemixplay)
            const hasActiveBid = conta.has_active_bid === true;
            
            // Calcular tempo restante do leil√£o usando auctionEndTime do wemixplay
            let timerHtml = '';
            if (hasActiveBid && conta.auctionEndTime) {
                const now = Math.floor(Date.now() / 1000);
                const tempoRestante = conta.auctionEndTime - now;
                if (tempoRestante > 0) {
                    const horas = Math.floor(tempoRestante / 3600);
                    const minutos = Math.floor((tempoRestante % 3600) / 60);
                    const segundos = tempoRestante % 60;
                    const textoTimer = `${String(horas).padStart(2, '0')}:${String(minutos).padStart(2, '0')}:${String(segundos).padStart(2, '0')}`;
                    timerHtml = `<span class="card-timer" data-auction-end="${conta.auctionEndTime}"><i class="fas fa-clock"></i> ${textoTimer}</span>`;
                } else {
                    timerHtml = `<span class="card-timer timer-expired"><i class="fas fa-clock"></i> EXPIRADO</span>`;
                }
            }
            
            const statusBadge = hasActiveBid ? 
                `<span class="card-status-badge badge-bidding">COM LANCE</span>` : 
                '<span class="card-status-badge">LISTADO</span>';
            
            // Estrutura do Card
            return `
            <div class="nft-card ${cardType}" id="card-${conta.seq}" data-nft-id="${conta.nftID}">
                <div class="card-top-bar">
                    ${statusBadge}
                    ${timerHtml}
                    <span class="card-price-top">${conta.price.toLocaleString()} WEMIX</span>
                </div>

                <div class="card-tabs">
                    <button class="card-tab-btn active" onclick="switchCardTab(this, ${conta.seq}, 0)"><i class="fas fa-home"></i></button>
                    <button class="card-tab-btn" onclick="switchCardTab(this, ${conta.seq}, 1)"><i class="fas fa-tshirt"></i></button>
                    <button class="card-tab-btn" onclick="switchCardTab(this, ${conta.seq}, 2)"><i class="fas fa-dumbbell"></i></button>
${isPremium ? '<button class="card-tab-btn" onclick="switchCardTab(this, ' + conta.seq + ', 3)"><i class="fas fa-box-open"></i></button>' : ''}
                    <!-- NOVOS BOT√ïES DAS ABAS ESPECIAIS -->
                    <button class="card-tab-btn" onclick="switchCardTab(this, ${conta.seq}, 4)"><i class="fas fa-ticket-alt"></i></button>
                    <button class="card-tab-btn" onclick="switchCardTab(this, ${conta.seq}, 5)"><i class="fas fa-gem"></i></button>
                    <button class="card-tab-btn" onclick="switchCardTab(this, ${conta.seq}, 6)"><i class="fas fa-shapes"></i></button>
                </div>

                <div class="tab-content active" data-tab="0">
                    ${tab0Content}
                </div>
                
                <div class="tab-content" data-tab="1">
                    ${tab1Content}
                </div>
                
                <div class="tab-content" data-tab="2">
                    ${tab2Content}
                </div>

${isPremium ? '<div class="tab-content" data-tab="3">' + tab3Content + '</div>' : ''}

                <!-- NOVAS ABAS ESPECIAIS -->
                <div class="tab-content" data-tab="4">
                    <center><div class="section-title">Bilhetes</div></center>
                    <div class="items-grid" id="tickets-items-${conta.seq}">
                        ${ticketsHtml}
                    </div>
                </div>

                <div class="tab-content" data-tab="5">
                    <center><div class="section-title">Cristais de Pico</div></center>
                    <div class="items-grid" id="crystals-items-${conta.seq}">
                        ${crystalsHtml}
                    </div>
                </div>

                <div class="tab-content" data-tab="6">
                    <center><div class="section-title">Fragmentos da Pra√ßa</div></center>
                    <div class="items-grid" id="fragments-items-${conta.seq}">
                        ${fragmentsHtml}
                    </div>
                </div>

                <a href="${conta.url}" target="_blank" class="card-action-btn" style="margin-top: auto;">
                    <div class="wemix-display">
                        <i class="fas fa-external-link-alt"></i>
                        ${conta.price.toLocaleString()} WEMIX
                    </div>
                    <div class="usd-display">${priceUsd}</div>
                </a>
                
                <button class="btn-todos-status" onclick="abrirModalTodosStatus(event)" 
                        data-stats='${JSON.stringify(Array.isArray(conta.stats) ? conta.stats : []).replace(/'/g, "&apos;")}'>
                    <i class="fas fa-list"></i> Todos os Status
                </button>

                <div class="card-footer-info">
    <span class="world-name">${conta.worldName}</span>
</div>
            </div>
            `;
        }

        // --- FUN√á√ïES DE INTERA√á√ÉO ---
        function switchCardTab(btn, cardSeq, tabIndex) {
            const card = document.getElementById(`card-${cardSeq}`);
            if (!card) return;

            // Remove active de todos os bot√µes e abas
            card.querySelectorAll('.card-tab-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            
            card.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

            // Se for uma das abas especiais (4, 5, 6) e ainda n√£o foi carregada, mostrar loading
            const targetTab = card.querySelector(`.tab-content[data-tab="${tabIndex}"]`);
            if (targetTab) {
                targetTab.classList.add('active');
                
                // Verificar se a aba j√° foi carregada
                if (tabIndex > 1 && !targetTab.dataset.loaded) {
                    // Mostrar loading
                    const originalHTML = targetTab.innerHTML;
                    targetTab.innerHTML = `
                        <div style="text-align: center; padding: 20px;">
                            <i class="fas fa-spinner fa-spin fa-2x"></i>
                            <p style="margin-top: 10px;">Carregando...</p>
                        </div>
                    `;
                    
                    // Simular carregamento (na pr√°tica, os dados j√° est√£o carregados)
                    setTimeout(() => {
                        targetTab.innerHTML = originalHTML;
                        targetTab.dataset.loaded = 'true';
                    }, 100);
                }
            }
        }

        // Fun√ß√£o para carregar mais itens do invent√°rio
        function carregarMaisInventario(cardSeq) {
            const card = document.getElementById(`card-${cardSeq}`);
            const btn = document.getElementById(`carregar-mais-btn-${cardSeq}`);
            const container = document.getElementById(`inven-items-${cardSeq}`);
            
            if (!card || !btn || !container) {
                console.error(`Elementos n√£o encontrados para card ${cardSeq}`);
                return;
            }
            
            // Encontrar a conta nos dados
            const conta = todasContas.find(c => String(c.seq) === String(cardSeq));
            
            if (!conta) {
                console.error(`Conta ${cardSeq} n√£o encontrada`);
                return;
            }
            
            // Usar inven_all que tem TODOS os itens
            const todosItens = (conta.inven_all || []).filter(item => item.trade === true);
            const itensJaMostrados = container.querySelectorAll('.item-circle').length;
            
            if (itensJaMostrados >= todosItens.length) {
                btn.innerHTML = '<i class="fas fa-check"></i> Todos os itens carregados';
                btn.disabled = true;
                setTimeout(() => { btn.style.display = 'none'; }, 2000);
                return;
            }
            
            // Mostrar loading no bot√£o
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Carregando...';
            btn.disabled = true;
            
            // Pequeno delay para feedback visual
            setTimeout(() => {
                const itemsPerPage = 12;
                const inicio = itensJaMostrados;
                const fim = Math.min(inicio + itemsPerPage, todosItens.length);
                const proximosItens = todosItens.slice(inicio, fim);
                
                if (proximosItens.length === 0) {
                    btn.innerHTML = '<i class="fas fa-check"></i> Todos os itens carregados';
                    btn.disabled = true;
                    setTimeout(() => { btn.style.display = 'none'; }, 2000);
                    return;
                }
                
                // Adicionar os novos itens ao container
                const novosItensHtml = proximosItens.map(item => renderItemIcon(item)).join('');
                container.insertAdjacentHTML('beforeend', novosItensHtml);
                
                // Atualizar o bot√£o
                const novosTotal = itensJaMostrados + proximosItens.length;
                const restantes = todosItens.length - novosTotal;
                
                if (restantes > 0) {
                    btn.innerHTML = `<i class="fas fa-plus"></i> Carregar mais itens (${restantes} restantes)`;
                    btn.disabled = false;
                } else {
                    btn.innerHTML = '<i class="fas fa-check"></i> Todos os itens carregados';
                    btn.disabled = true;
                    setTimeout(() => { btn.style.display = 'none'; }, 2000);
                }
            }, 300);
        }

        // --- BUSCA E FILTROS ---
        function buscarContas() {
            const resultados = document.getElementById('resultados');
            resultados.innerHTML = '<div class="loading"><i class="fas fa-circle-notch fa-spin fa-2x"></i><p>Carregando dados...</p></div>';
            
            paginaAtual = 0;
            todasContas = [];
            
            const params = new URLSearchParams();
            params.append('cache_tipo', cacheTipo);
            params.append('pagina', paginaAtual);
            params.append('limite', LIMITE_POR_PAGINA);
            
            // Busca por nome
            const buscaNome = document.getElementById('busca_nome');
            if (buscaNome && buscaNome.value.trim()) {
                params.append('nome_jogador', buscaNome.value.trim());
            }
            
            // Filtro por status (listado/bidding)
            if (filtroStatusAtual) {
                params.append('status_lance', filtroStatusAtual);
            }
            
            // Filtros de Treino
            const treinoIds = ['treino_constituicao', 'treino_muscular', 'treino_noveyin', 'treino_noveyang', 'treino_sapo'];
            treinoIds.forEach(id => {
                const el = document.getElementById(id);
                if (el && el.value && parseFloat(el.value) > 0) {
                    params.append(id, el.value);
                }
            });
            
            // Filtros de Esp√≠ritos
            if (espiritosAtivos.size > 0) {
                params.append('espiritos', Array.from(espiritosAtivos).join(','));
            }
            
            // Filtros de Trade (itens comercializ√°veis)
            const equipLendTrade = document.getElementById('equip_lend_trade_min')?.value;
            const equipEpicTrade = document.getElementById('equip_epic_trade_min')?.value;
            if (equipLendTrade && parseInt(equipLendTrade) > 0) {
                params.append('equip_lend_trade_min', equipLendTrade);
            }
            if (equipEpicTrade && parseInt(equipEpicTrade) > 0) {
                params.append('equip_epic_trade_min', equipEpicTrade);
            }
            
            // Filtros de Skills/Habilidades
            const skillsFiltro = getSkillsFiltro();
            if (skillsFiltro.length > 0) {
                params.append('skills_filtro', JSON.stringify(skillsFiltro));
            }
            
            // Coleta filtros b√°sicos
            const ids = [
                'classe', 'power_min', 'power_max', 'level_min', 'level_max', 
                'price_min', 'price_max', 'mina_min', 'codex_min', 'potencial_min',
                'pets_lendarios_min', 'pets_misticos_min', 'habs_lendarias_min',
                'constituicao_min', 'itens_comercio_min', 'regiao', 'servidor'
            ];
            
            ids.forEach(id => {
                const el = document.getElementById(id);
                if (el && el.value) params.append(id, el.value);
            });

            // Status de minera√ß√£o - IMPORTANTE: usar os IDs corretos
            const aceleramento = document.getElementById('status_aceleramento');
            const aconegro = document.getElementById('status_aconegro');
            
            // Use o hash do status para os par√¢metros
            {% for status in status_importantes %}
                {% if status.destaque and "Aceleramento de Minera√ß√£o" in status.nome %}
                    if (aceleramento && aceleramento.value) {
                        params.append('status_{{ status.hash }}', aceleramento.value);
                    }
                {% endif %}
                {% if status.destaque and "Aumento de Ganho de A√ßo Negro" in status.nome %}
                    if (aconegro && aconegro.value) {
                        params.append('status_{{ status.hash }}', aconegro.value);
                    }
                {% endif %}
            {% endfor %}

            // Status din√¢micos do modal
            document.querySelectorAll('#lista-status input').forEach(input => {
                if (input.value) params.append(input.id, input.value);
            });

            // Filtros de itens espec√≠ficos
            for (const [hash, data] of Object.entries(filtrosItensAtivos)) {
                params.append(`item_${hash}`, data.qtd);
            }

            // Ordena√ß√£o
            const ordenacao = document.getElementById('ordenacao').value;
            if (ordenacao.includes('price')) {
                params.append('ordenar_por', 'price');
                params.append('ordenar_desc', ordenacao === 'price_desc');
            } else if (ordenacao === 'aceleramento' || ordenacao === 'aconegro') {
                params.append('ordenar_por', ordenacao);
                params.append('ordenar_desc', 'true');
            } else {
                params.append('ordenar_por', ordenacao);
                params.append('ordenar_desc', 'true');
            }

            filtrosAtuais = params;

            fetch(`/buscar-contas?${params.toString()}`)
                .then(r => r.json())
                .then(data => {
                    if (data.success) {
                        todasContas = data.contas || [];
                        totalContasFiltradas = data.total_filtrado || 0;
                        renderizarResultados(todasContas);
                        atualizarFiltrosAtivos();
                        
                        // Mostrar notifica√ß√£o com status aplicados
                        const statusFiltros = Array.from(params.entries())
                            .filter(([key]) => key.startsWith('status_'))
                            .map(([key, value]) => `${key.replace('status_', '')}: ${value}`);
                        
                        if (statusFiltros.length > 0) {
                            mostrarNotificacao(`${statusFiltros.length} filtro(s) de status aplicado(s)`, 'success');
                        }
                    } else {
                        resultados.innerHTML = `<div class="sem-resultados"><p>${data.error}</p></div>`;
                    }
                })
                .catch(e => {
                    console.error("Erro na busca:", e);
                    resultados.innerHTML = '<div class="sem-resultados"><p>Erro de conex√£o</p></div>';
                });
        }

        function carregarMaisContas() {
            paginaAtual++;
            const btn = document.querySelector('.paginacao-container button');
            if (!btn) return;
            
            const originalText = btn.innerText;
            btn.innerText = "Carregando...";
            btn.disabled = true;

            filtrosAtuais.set('pagina', paginaAtual);

            fetch(`/buscar-contas?${filtrosAtuais.toString()}`)
                .then(r => r.json())
                .then(data => {
                    if (data.success && data.contas && data.contas.length > 0) {
                        todasContas = [...todasContas, ...data.contas];
                        renderizarResultados(todasContas);
                    }
                    btn.innerText = originalText;
                    btn.disabled = false;
                })
                .catch(() => {
                    btn.innerText = originalText;
                    btn.disabled = false;
                });
        }

        function renderizarResultados(contas) {
            const resultados = document.getElementById('resultados');
            const pagContainer = document.getElementById('paginacao-container');
            const infoPag = document.getElementById('info-paginacao');
            const totalNftsEl = document.getElementById('total-nfts');
            
            // Atualizar contador de NFTs
            if (totalNftsEl) {
                totalNftsEl.textContent = totalContasFiltradas || contas.length;
            }

            if (contas.length === 0) {
                resultados.innerHTML = `
                    <div class="sem-resultados">
                        <i class="fas fa-ghost fa-2x"></i>
                        <h3>Nenhuma conta encontrada</h3>
                        <p>Tente diminuir os filtros.</p>
                    </div>`;
                pagContainer.style.display = 'none';
                return;
            }

            resultados.innerHTML = contas.map(conta => criarCardConta(conta)).join('');
            
            if (contas.length < totalContasFiltradas) {
                pagContainer.style.display = 'flex';
                pagContainer.style.flexDirection = 'column';
                pagContainer.style.alignItems = 'center';
                infoPag.textContent = `Mostrando ${contas.length} de ${totalContasFiltradas}`;
            } else {
                pagContainer.style.display = 'none';
            }
        }

        // --- UI FUNCTIONS ---
        
        // Mini Dropdowns
        function toggleMiniDropdown(id) {
            const dropdown = document.getElementById(id);
            const allDropdowns = document.querySelectorAll('.mini-dropdown-content');
            
            // Fecha outros dropdowns
            allDropdowns.forEach(dd => {
                if (dd.id !== id) {
                    dd.classList.remove('show');
                }
            });
            
            dropdown.classList.toggle('show');
        }
        
        // ========== SISTEMA DE FILTROS ATIVOS ==========
        function atualizarFiltrosAtivos() {
            const area = document.getElementById('filtros-ativos-area');
            const container = document.getElementById('filtros-tags');
            if (!area || !container) return;
            
            container.innerHTML = '';
            let temFiltros = false;
            
            // Mapeia campos de filtros para labels amig√°veis
            const camposFiltros = {
                'busca_nome': { label: 'Nome', tipo: 'texto' },
                'servidor': { label: 'Servidor', tipo: 'texto' },
                'regiao': { label: 'Regi√£o', tipo: 'texto' },
                'power_min': { label: 'Poder M√≠n', tipo: 'numero' },
                'level_min': { label: 'Level M√≠n', tipo: 'numero' },
                'mina_min': { label: 'Mina N√≠vel', tipo: 'numero' },
                'status_aceleramento': { label: 'Boost Minera√ß√£o', tipo: 'percentual' },
                'status_aconegro': { label: 'A√ßo Negro', tipo: 'percentual' },
                'treino_constituicao': { label: 'Constitui√ß√£o', tipo: 'numero' },
                'treino_muscular': { label: 'Muscular', tipo: 'numero' },
                'treino_noveyin': { label: 'Nove Yin', tipo: 'numero' },
                'treino_noveyang': { label: 'Nove Yang', tipo: 'numero' },
                'treino_sapo': { label: 'Sapo', tipo: 'numero' },
                'price_min': { label: 'Pre√ßo M√≠n', tipo: 'wemix' },
                'price_max': { label: 'Pre√ßo M√°x', tipo: 'wemix' },
                'item_busca': { label: 'Item', tipo: 'texto' },
                'equip_lend_trade_min': { label: 'Equip Lend. Trade', tipo: 'numero' },
                'equip_epic_trade_min': { label: 'Equip √âpico Trade', tipo: 'numero' },
                'codex_min': { label: 'Codex M√≠n', tipo: 'numero' },
                'potencial_min': { label: 'Potencial M√≠n', tipo: 'numero' },
                'itens_comercio_min': { label: 'Equip. Lend√°rios', tipo: 'numero' }
            };
            
            // Verificar cada campo de filtro
            for (const [campoId, config] of Object.entries(camposFiltros)) {
                const el = document.getElementById(campoId);
                if (el && el.value && el.value.trim() !== '') {
                    let valor = el.value.trim();
                    if (config.tipo === 'numero' && parseFloat(valor) <= 0) continue;
                    if (config.tipo === 'percentual') valor += '%';
                    if (config.tipo === 'wemix') valor += ' WEMIX';
                    
                    temFiltros = true;
                    adicionarTagFiltro(container, campoId, config.label, valor);
                }
            }
            
            // Verificar classes selecionadas
            const classesAtivas = document.querySelectorAll('.classe-btn.ativa');
            if (classesAtivas.length > 0 && classesAtivas.length < 5) {
                const nomes = Array.from(classesAtivas).map(btn => btn.title || btn.dataset.classe || 'Classe').join(', ');
                temFiltros = true;
                adicionarTagFiltro(container, 'classes', 'Classes', nomes, () => {
                    document.querySelectorAll('.classe-btn').forEach(b => b.classList.remove('ativa'));
                    atualizarFiltrosAtivos();
                });
            }
            
            // Verificar esp√≠ritos selecionados
            if (typeof espiritosAtivos !== 'undefined' && espiritosAtivos.size > 0) {
                temFiltros = true;
                adicionarTagFiltro(container, 'espiritos', 'Esp√≠ritos', `${espiritosAtivos.size} selecionados`, () => {
                    espiritosAtivos.clear();
                    document.querySelectorAll('.esp-card-mini.selecionado').forEach(c => c.classList.remove('selecionado'));
                    // Atualizar contador do bot√£o
                    if (typeof atualizarCountEspiritos === 'function') atualizarCountEspiritos();
                    atualizarFiltrosAtivos();
                });
            }
            
            // Verificar habilidades/skills selecionadas
            if (typeof skillsAtivas !== 'undefined') {
                let totalSkills = 0;
                for (const classe in skillsAtivas) {
                    totalSkills += Object.keys(skillsAtivas[classe]).length;
                }
                if (totalSkills > 0) {
                    temFiltros = true;
                    adicionarTagFiltro(container, 'skills', 'Habilidades', `${totalSkills} selecionadas`, () => {
                        skillsAtivas = {};
                        document.querySelectorAll('.skill-btn').forEach(b => {
                            b.classList.remove('selecionado-epica', 'selecionado-lendaria');
                        });
                        // Atualizar contador do bot√£o
                        if (typeof atualizarCountSkills === 'function') atualizarCountSkills();
                        atualizarFiltrosAtivos();
                    });
                }
            }
            
            // Verificar status selecionados (inputs numericos em #lista-status)
            const statusInputs = document.querySelectorAll('#lista-status input[type="number"]');
            let statusPreenchidos = 0;
            let statusNomes = [];
            statusInputs.forEach(input => {
                const val = parseFloat(input.value);
                if (val && val > 0) {
                    statusPreenchidos++;
                    // Pegar o nome do status do label associado
                    const statusItem = input.closest('.status-item');
                    if (statusItem) {
                        const label = statusItem.querySelector('label');
                        if (label) statusNomes.push(label.textContent.trim());
                    }
                }
            });
            if (statusPreenchidos > 0) {
                temFiltros = true;
                const descricao = statusPreenchidos <= 2 ? statusNomes.join(', ') : `${statusPreenchidos} status`;
                adicionarTagFiltro(container, 'status_filtros', 'Status', descricao, () => {
                    statusInputs.forEach(input => input.value = '');
                    atualizarFiltrosAtivos();
                });
            }
            
            // Verificar itens selecionados
            if (typeof filtrosItensAtivos !== 'undefined' && Object.keys(filtrosItensAtivos).length > 0) {
                const totalItens = Object.keys(filtrosItensAtivos).length;
                const nomesItens = Object.values(filtrosItensAtivos).map(i => i.nome).slice(0, 2);
                const descricao = totalItens <= 2 ? nomesItens.join(', ') : `${totalItens} itens`;
                temFiltros = true;
                adicionarTagFiltro(container, 'filtro_itens', 'Itens', descricao, () => {
                    filtrosItensAtivos = {};
                    const itensLista = document.getElementById('itens-filtro-lista');
                    if (itensLista) itensLista.innerHTML = '';
                    if (typeof atualizarCountItens === 'function') atualizarCountItens();
                    atualizarFiltrosAtivos();
                });
            }
            
            // Mostrar/ocultar √°rea
            area.style.display = temFiltros ? 'block' : 'none';
        }
        
        function adicionarTagFiltro(container, campoId, label, valor, customRemover = null) {
            const tag = document.createElement('div');
            tag.className = 'filtro-tag';
            tag.innerHTML = `
                <span class="tag-label">${label}:</span>
                <span class="tag-value">${valor}</span>
                <span class="tag-remover" onclick="removerFiltroAtivo('${campoId}', this.closest('.filtro-tag'))">
                    <i class="fas fa-times"></i>
                </span>
            `;
            
            if (customRemover) {
                tag.querySelector('.tag-remover').onclick = function() {
                    customRemover();
                    this.closest('.filtro-tag').remove();
                };
            }
            
            container.appendChild(tag);
        }
        
        function removerFiltroAtivo(campoId, tagElement) {
            // Tratar casos especiais
            if (campoId === 'classes') {
                document.querySelectorAll('.classe-btn').forEach(b => b.classList.remove('ativa'));
            } else if (campoId === 'espiritos') {
                if (typeof espiritosAtivos !== 'undefined') espiritosAtivos.clear();
                document.querySelectorAll('.esp-card-mini.selecionado').forEach(c => c.classList.remove('selecionado'));
                document.querySelectorAll('.espirito-item.selected').forEach(c => c.classList.remove('selected'));
                if (typeof atualizarCountEspiritos === 'function') atualizarCountEspiritos();
            } else if (campoId === 'habilidades') {
                if (typeof skillsAtivas !== 'undefined') {
                    for (const classe in skillsAtivas) {
                        skillsAtivas[classe] = {};
                    }
                }
                document.querySelectorAll('.skill-item.selected').forEach(c => c.classList.remove('selected'));
                if (typeof atualizarCountHabilidades === 'function') atualizarCountHabilidades();
            } else {
                // Campo normal - limpar input
                const el = document.getElementById(campoId);
                if (el) {
                    el.value = '';
                    // Disparar evento de change para atualizar contadores
                    el.dispatchEvent(new Event('change', { bubbles: true }));
                }
            }
            
            // Remover tag
            if (tagElement) tagElement.remove();
            
            // Atualizar √°rea de filtros
            atualizarFiltrosAtivos();
            
            console.log('[FILTROS] Filtro removido:', campoId);
        }
        
        function limparTodosFiltros() {
            // Limpar todos os inputs de texto e n√∫mero
            const inputs = document.querySelectorAll('input[type="text"], input[type="number"]');
            inputs.forEach(input => {
                if (input.id && !input.id.includes('login') && !input.id.includes('register') && !input.id.includes('senha')) {
                    input.value = '';
                    // Disparar evento de change
                    input.dispatchEvent(new Event('change', { bubbles: true }));
                }
            });
            
            // Limpar selects
            document.querySelectorAll('select').forEach(sel => {
                if (sel.id && !sel.id.includes('login') && !sel.id.includes('register')) {
                    sel.selectedIndex = 0;
                    sel.dispatchEvent(new Event('change', { bubbles: true }));
                }
            });
            
            // Limpar classes
            document.querySelectorAll('.classe-btn').forEach(b => b.classList.remove('ativa'));
            
            // Limpar esp√≠ritos
            if (typeof espiritosAtivos !== 'undefined') {
                espiritosAtivos.clear();
            }
            document.querySelectorAll('.esp-card-mini.selecionado').forEach(c => c.classList.remove('selecionado'));
            document.querySelectorAll('.espirito-item.selected').forEach(c => c.classList.remove('selected'));
            
            // Limpar habilidades/skills
            if (typeof skillsAtivas !== 'undefined') {
                for (const classe in skillsAtivas) {
                    skillsAtivas[classe] = {};
                }
            }
            document.querySelectorAll('.skill-item.selected').forEach(c => c.classList.remove('selected'));
            
            // Limpar status (inputs numericos)
            document.querySelectorAll('#lista-status input[type="number"]').forEach(input => {
                input.value = '';
            });
            
            // Limpar filtros de itens
            if (typeof filtrosItensAtivos !== 'undefined') {
                for (const key in filtrosItensAtivos) {
                    delete filtrosItensAtivos[key];
                }
            }
            const itensLista = document.getElementById('itens-filtro-lista');
            if (itensLista) itensLista.innerHTML = '';
            
            // Atualizar todos os contadores
            if (typeof atualizarCountMineracao === 'function') atualizarCountMineracao();
            if (typeof atualizarCountTreino === 'function') atualizarCountTreino();
            if (typeof atualizarCountCombate === 'function') atualizarCountCombate();
            if (typeof atualizarCountPreco === 'function') atualizarCountPreco();
            if (typeof atualizarCountGeral === 'function') atualizarCountGeral();
            if (typeof atualizarCountEspiritos === 'function') atualizarCountEspiritos();
            if (typeof atualizarCountHabilidades === 'function') atualizarCountHabilidades();
            if (typeof atualizarCountStatus === 'function') atualizarCountStatus();
            if (typeof atualizarCountItens === 'function') atualizarCountItens();
            
            // Limpar container de tags
            const tagsContainer = document.getElementById('filtros-tags');
            if (tagsContainer) tagsContainer.innerHTML = '';
            
            // Esconder √°rea de filtros ativos
            const area = document.getElementById('filtros-ativos-area');
            if (area) area.style.display = 'none';
            
            // Mostrar feedback
            const btn = document.querySelector('.btn-limpar-todos');
            if (btn) {
                const textoOriginal = btn.innerHTML;
                btn.innerHTML = '<i class="fas fa-check"></i> Limpo!';
                btn.style.background = 'linear-gradient(135deg, #48bb78 0%, #38a169 100%)';
                setTimeout(() => {
                    btn.innerHTML = textoOriginal;
                    btn.style.background = '';
                }, 1500);
            }
            
            console.log('[FILTROS] Todos os filtros foram limpos');
        }
        
        // Fecha dropdowns ao clicar fora
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.mini-dropdown')) {
                document.querySelectorAll('.mini-dropdown-content').forEach(dd => {
                    dd.classList.remove('show');
                });
            }
        });
        
        function toggleDropdown(id) {
            const dropdown = document.getElementById(id);
            const parent = dropdown.closest('.dropdown-filtro');
            
            if (dropdown.style.display === 'none') {
                dropdown.style.display = 'block';
                parent.classList.add('open');
            } else {
                dropdown.style.display = 'none';
                parent.classList.remove('open');
            }
        }
        
        function atualizarCountMineracao() {
            let count = 0;
            const mina = document.getElementById('mina_min')?.value;
            const boost = document.getElementById('status_aceleramento')?.value;
            const acoNegro = document.getElementById('status_aconegro')?.value;
            
            if (mina && parseFloat(mina) > 0) count++;
            if (boost && parseFloat(boost) > 0) count++;
            if (acoNegro && parseFloat(acoNegro) > 0) count++;
            
            const countEl = document.getElementById('count-mineracao');
            if (countEl) {
                countEl.textContent = count;
                countEl.classList.toggle('has-value', count > 0);
            }
        }
        
        function atualizarCountTreino() {
            let count = 0;
            const constituicao = document.getElementById('treino_constituicao')?.value;
            const musculo = document.getElementById('treino_muscular')?.value;
            const nineyin = document.getElementById('treino_noveyin')?.value;
            const nineyang = document.getElementById('treino_noveyang')?.value;
            const sapo = document.getElementById('treino_sapo')?.value;
            
            if (constituicao && parseFloat(constituicao) > 0) count++;
            if (musculo && parseFloat(musculo) > 0) count++;
            if (nineyin && parseFloat(nineyin) > 0) count++;
            if (nineyang && parseFloat(nineyang) > 0) count++;
            if (sapo && parseFloat(sapo) > 0) count++;
            
            const countEl = document.getElementById('count-treino');
            if (countEl) {
                countEl.textContent = count;
                countEl.classList.toggle('has-value', count > 0);
            }
        }
        
        function atualizarCountNivel() {
            let count = 0;
            const codex = document.getElementById('codex_min')?.value;
            const potencial = document.getElementById('potencial_min')?.value;
            const itens = document.getElementById('itens_comercio_min')?.value;
            
            if (codex && parseFloat(codex) > 0) count++;
            if (potencial && parseFloat(potencial) > 0) count++;
            if (itens && parseFloat(itens) > 0) count++;
            
            const countEl = document.getElementById('count-nivel');
            if (countEl) {
                countEl.textContent = count;
                countEl.classList.toggle('has-value', count > 0);
            }
        }
        
        function atualizarCountTrade() {
            let count = 0;
            const lend = document.getElementById('equip_lend_trade_min')?.value;
            const epic = document.getElementById('equip_epic_trade_min')?.value;
            
            if (lend && parseFloat(lend) > 0) count++;
            if (epic && parseFloat(epic) > 0) count++;
            
            const countEl = document.getElementById('count-trade');
            if (countEl) {
                countEl.textContent = count;
                countEl.classList.toggle('has-value', count > 0);
            }
        }
        
        // Filtrar por status (Listado / Com Lance)
        let filtroStatusAtual = 'listado';
        
        function filtrarPorStatus(status) {
            filtroStatusAtual = status;
            
            document.querySelectorAll('.tab-status').forEach(tab => tab.classList.remove('active'));
            document.getElementById(`tab-${status}`).classList.add('active');
            
            // Rebuscar com o novo filtro
            buscarContas();
        }
        
        function mostrarAba(id) {
            document.querySelectorAll('.conteudo-aba').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.aba-filtro').forEach(el => el.classList.remove('active'));
            document.getElementById(`aba-${id}`).classList.add('active');
            
            const btns = document.querySelectorAll('.aba-filtro');
            for (let i = 0; i < btns.length; i++) {
                if (btns[i].textContent.trim().toLowerCase().includes(id.toLowerCase())) {
                    btns[i].classList.add('active');
                }
            }
        }

        function selecionarCache(tipo) {
            cacheTipo = tipo;
            document.querySelectorAll('.cache-type-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(`cache-${tipo}`).classList.add('active');
            const ci2 = document.getElementById('cache-info'); if(ci2) ci2.innerText = `Modo: ${tipo === 'completas' ? 'Cache Completo' : 'Cache Teste'}`;
        }

        function mudarOrdenacao() {
            buscarContas();
        }

        function carregarCacheTeste() {
            addCacheLog("Iniciando carregamento de teste...", "info");
            if(!confirm("Carregar 10 contas de teste?")) return;
            addCacheLog('Iniciando carregamento de 10 contas...', 'info');
            
            // Mostrar status de carregamento
            const ci = document.getElementById('cache-info'); if(ci) ci.innerHTML = "Status: <span style='color: #f6e05e'>üîÑ Carregando 10 contas...</span>";
            
            // Desabilitar bot√µes durante o carregamento
            const botoesCache = document.querySelectorAll('.cache-type-btn, .btn-buscar');
            botoesCache.forEach(btn => btn.disabled = true);
            
            fetch('/carregar-teste', {method: 'POST', headers: {'X-CSRFToken': document.querySelector('input[name=csrf_token]')?.value || ''}})
                .then(r => r.json())
                .then(d => { 
                    if (d.success) {
                        // O carregamento foi INICIADO
                        mostrarNotificacao('Carregamento de teste iniciado. Aguarde...', 'info');
                        addCacheLog('Carregamento de teste iniciado...', 'info');
                        
                        // Delay de 2 segundos para garantir que a thread come√ßou
                        setTimeout(() => monitorarCarregamento('teste', 0), 2000);
                    } else {
                        botoesCache.forEach(btn => btn.disabled = false);
                        mostrarNotificacao(d.message || 'Erro ao iniciar carregamento', 'error');
                        verificarStatusCache(false);
                    }
                })
                .catch((error) => {
                    // Reabilitar bot√µes
                    botoesCache.forEach(btn => btn.disabled = false);
                    console.error('Erro:', error);
                    mostrarNotificacao("Erro de conex√£o ao carregar cache", 'error');
                    addCacheLog('‚ùå Erro de conex√£o', 'error');
                    verificarStatusCache(false);
                });
        }

        function carregarCacheCompleto() {
            addCacheLog("Iniciando carregamento completo...", "info");
            if (!confirm("Carregar TODAS as contas? Isso pode demorar v√°rios minutos.")) return;
            addCacheLog('Iniciando carregamento completo...', 'info');
            
            // Mostrar status de carregamento
            const ci = document.getElementById('cache-info'); if(ci) ci.innerHTML = "Status: <span style='color: #f6e05e'>üîÑ Iniciando carregamento completo...</span>";
            
            // Desabilitar bot√µes durante o carregamento
            const botoesCache = document.querySelectorAll('.cache-type-btn, .btn-buscar');
            botoesCache.forEach(btn => btn.disabled = true);
            
            fetch('/carregar-completo', {method: 'POST', headers: {'X-CSRFToken': document.querySelector('input[name=csrf_token]')?.value || ''}})
                .then(r => r.json())
                .then(d => { 
                    if (d.success) {
                        // O carregamento foi INICIADO (n√£o conclu√≠do)
                        // Come√ßar a monitorar o progresso ap√≥s um pequeno delay
                        mostrarNotificacao('Carregamento completo iniciado. Aguarde...', 'info');
                        addCacheLog('Carregamento iniciado, aguardando in√≠cio...', 'info');
                        
                        // Delay de 2 segundos para garantir que a thread come√ßou
                        setTimeout(() => monitorarCarregamento('completas', 0), 2000);
                    } else {
                        botoesCache.forEach(btn => btn.disabled = false);
                        mostrarNotificacao(d.message || 'Erro ao iniciar carregamento', 'error');
                        verificarStatusCache(false);
                    }
                })
                .catch((error) => {
                    // Reabilitar bot√µes
                    botoesCache.forEach(btn => btn.disabled = false);
                    console.error('Erro:', error);
                    mostrarNotificacao("Erro de conex√£o ao carregar cache completo", 'error');
                    addCacheLog('‚ùå Erro de conex√£o', 'error');
                    verificarStatusCache(false);
                });
        }
        
        // Nova fun√ß√£o para monitorar carregamento
        // tentativas: contador para evitar falso negativo no in√≠cio
        function monitorarCarregamento(tipo, tentativas = 0) {
            fetch('/status-carregamento')
                .then(r => r.json())
                .then(data => {
                    const info = document.getElementById('cache-info');
                    const botoesCache = document.querySelectorAll('.cache-type-btn, .btn-buscar');
                    
                    if (data.carregando) {
                        // Ainda carregando - mostrar progresso
                        const prog = data.progresso || {};
                        if (prog.atual > 0 && prog.total > 0) {
                            const pct = Math.round((prog.atual / prog.total) * 100);
                            if (info) info.innerHTML = `Status: <span style='color: #f6e05e'>üîÑ Carregando... ${prog.atual}/${prog.total} (${pct}%)</span>`;
                            // S√≥ adiciona log a cada 10% para n√£o poluir
                            if (pct % 10 === 0 || prog.atual === prog.total) {
                                addCacheLog(`Processando ${prog.atual} de ${prog.total} contas (${pct}%)`, 'info');
                            }
                        } else {
                            if (info) info.innerHTML = "Status: <span style='color: #f6e05e'>üîÑ Buscando lista de contas...</span>";
                        }
                        // Verificar novamente em 3 segundos
                        setTimeout(() => monitorarCarregamento(tipo, 0), 3000);
                    } else {
                        // N√£o est√° carregando - mas pode ser que ainda n√£o come√ßou!
                        // Se temos menos de 10 tentativas e n√£o h√° cache ainda, esperar mais
                        const cacheExiste = (tipo === 'completas' && data.tem_cache_completo && data.total_completo > 0) ||
                                           (tipo === 'teste' && data.tem_cache_teste && data.total_teste > 0);
                        
                        if (!cacheExiste && tentativas < 10) {
                            // Ainda esperando thread iniciar - N√ÉO adicionar log para n√£o poluir
                            // Removido: n√£o mostrar "Iniciando" para evitar altern√¢ncia com progresso
                            setTimeout(() => monitorarCarregamento(tipo, tentativas + 1), 2000);
                            return;
                        }
                        
                        // Carregamento realmente conclu√≠do - reabilitar bot√µes
                        botoesCache.forEach(btn => btn.disabled = false);
                        
                        if (tipo === 'completas' && data.tem_cache_completo && data.total_completo > 0) {
                            if (info) info.innerHTML = `Status: <span style='color: #48bb78'>‚úÖ Cache Completo (${data.total_completo} contas)</span>`;
                            addCacheLog(`‚úÖ Carregamento conclu√≠do: ${data.total_completo} contas`, 'success');
                            // S√≥ mostrar notifica√ß√£o se ainda n√£o foi mostrada nessa sess√£o
                            if (!window.cacheNotificado) {
                                mostrarNotificacao(`Cache completo carregado: ${data.total_completo} contas`, 'success');
                                window.cacheNotificado = true;
                            }
                            selecionarCache('completas');
                            buscarContas();
                        } else if (tipo === 'teste' && data.tem_cache_teste && data.total_teste > 0) {
                            if (info) info.innerHTML = `Status: <span style='color: #ed8936'>‚ö†Ô∏è Cache Teste (${data.total_teste} contas)</span>`;
                            addCacheLog(`‚úÖ Teste conclu√≠do: ${data.total_teste} contas`, 'success');
                            mostrarNotificacao(`Cache teste carregado: ${data.total_teste} contas`, 'success');
                            selecionarCache('teste');
                            buscarContas();
                        } else {
                            if (info) info.innerHTML = "Status: <span style='color: #f56565'>‚ùå Falha no carregamento</span>";
                            addCacheLog('‚ùå Carregamento falhou ou cache vazio', 'error');
                            mostrarNotificacao('Carregamento falhou. Tente novamente.', 'error');
                        }
                    }
                })
                .catch(err => {
                    console.error('Erro ao monitorar:', err);
                    // Tentar novamente em 5 segundos
                    setTimeout(() => monitorarCarregamento(tipo, tentativas), 5000);
                });
        }

        // Atualize a fun√ß√£o verificarStatusCache
        function verificarStatusCache(buscarAposCarregar = false) {
            return fetch('/status-carregamento')
                .then(r => r.json())
                .then(data => {
                    const info = document.getElementById('cache-info'); if(!info) return;
                    
                    if (data.carregando) {
                        // Mostrar progresso detalhado
                        const prog = data.progresso || {};
                        if (prog.atual > 0 && prog.total > 0) {
                            const pct = Math.round((prog.atual / prog.total) * 100);
                            info.innerHTML = `Status: <span style='color: #f6e05e'>üîÑ Carregando... ${prog.atual}/${prog.total} (${pct}%)</span>`;
                            addCacheLog(`Processando conta ${prog.atual} de ${prog.total}...`, 'info');
                        } else {
                            info.innerHTML = "Status: <span style='color: #f6e05e'>üîÑ Carregando...</span>";
                        }
                        // Verificar novamente em 2 segundos se ainda estiver carregando
                        setTimeout(() => verificarStatusCache(buscarAposCarregar), 2000);
                    } else {
                        // Atualizar baseado no que est√° dispon√≠vel
                        if (data.tem_cache_completo && data.total_completo > 0) {
                            info.innerHTML = `Status: <span style='color: #48bb78'>‚úÖ Cache Completo (${data.total_completo} contas)</span>`;
                            if (buscarAposCarregar) {
                                selecionarCache('completas');
                            }
                        } else if (data.tem_cache_teste && data.total_teste > 0) {
                            info.innerHTML = `Status: <span style='color: #ed8936'>‚ö†Ô∏è Cache Teste (${data.total_teste} contas)</span>`;
                            if (buscarAposCarregar) {
                                selecionarCache('teste');
                            }
                        } else {
                            info.innerHTML = "Status: <span style='color: #f56565'>‚ùå Sem Cache - Use os bot√µes acima</span>";
                        }
                    }
                    return data;
                })
                .catch(() => {
                    const ci = document.getElementById('cache-info'); if(ci) ci.innerHTML = "Status: <span style='color: #f56565'>‚ùå Erro ao verificar</span>";
                });
        }
        // ===== FUN√á√ïES DOS MODAIS DE AUTENTICA√á√ÉO =====
        function abrirModalLogin() {
            document.getElementById('modal-login').style.display = 'flex';
            document.body.style.overflow = 'hidden';
            document.getElementById('login-error').style.display = 'none';
        }
        
        function abrirModalRegister() {
            document.getElementById('modal-register').style.display = 'flex';
            document.body.style.overflow = 'hidden';
            document.getElementById('register-error').style.display = 'none';
        }
        
        function trocarModal(fechar, abrir) {
            document.getElementById(fechar).style.display = 'none';
            document.getElementById(abrir).style.display = 'flex';
        }
        
        function fecharModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.style.display = 'none';
                document.body.style.overflow = 'auto';
            }
        }
        
        async function submitLogin(event) {
            event.preventDefault();
            const form = document.getElementById('form-login');
            const formData = new FormData(form);
            const errorDiv = document.getElementById('login-error');
            
            try {
                const response = await fetch('/auth/login-ajax', {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                
                if (data.success) {
                    errorDiv.style.display = 'none';
                    // Recarrega a p√°gina para atualizar o estado de login
                    window.location.reload();
                } else {
                    errorDiv.textContent = data.message || 'Erro ao fazer login';
                    errorDiv.style.display = 'block';
                }
            } catch (error) {
                errorDiv.textContent = 'Erro de conex√£o. Tente novamente.';
                errorDiv.style.display = 'block';
            }
            return false;
        }
        
        async function submitRegister(event) {
            event.preventDefault();
            const form = document.getElementById('form-register');
            const formData = new FormData(form);
            const errorDiv = document.getElementById('register-error');
            
            // Validar senhas
            const password = document.getElementById('register-password').value;
            const password2 = document.getElementById('register-password2').value;
            
            if (password !== password2) {
                errorDiv.textContent = 'As senhas n√£o coincidem';
                errorDiv.style.display = 'block';
                return false;
            }
            
            try {
                const response = await fetch('/auth/register-ajax', {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                
                if (data.success) {
                    // Mostrar sucesso e trocar para login
                    errorDiv.className = 'modal-success';
                    errorDiv.textContent = 'Conta criada com sucesso! Fazendo login...';
                    errorDiv.style.display = 'block';
                    
                    setTimeout(() => {
                        window.location.reload();
                    }, 1500);
                } else {
                    errorDiv.className = 'modal-error';
                    errorDiv.textContent = data.message || 'Erro ao criar conta';
                    errorDiv.style.display = 'block';
                }
            } catch (error) {
                errorDiv.className = 'modal-error';
                errorDiv.textContent = 'Erro de conex√£o. Tente novamente.';
                errorDiv.style.display = 'block';
            }
            return false;
        }
        
        // ===== FUN√á√ïES DO LOG DE CACHE =====
        let cacheLogMessages = [];
        
        function addCacheLog(message, type = 'info') {
            const now = new Date();
            const time = now.toLocaleTimeString('pt-BR');
            cacheLogMessages.unshift({ time, message, type });
            
            // Mant√©m apenas as √∫ltimas 50 mensagens
            if (cacheLogMessages.length > 50) {
                cacheLogMessages.pop();
            }
            
            updateCacheLogDisplay();
        }
        
        function updateCacheLogDisplay() {
            const container = document.getElementById('cache-log-content');
            if (!container) return;
            
            container.innerHTML = cacheLogMessages.map(log => 
                `<div class="log-line">
                    <span class="log-time">[${log.time}]</span>
                    <span class="log-${log.type}">${log.message}</span>
                </div>`
            ).join('');
        }
        
        function toggleCacheLog() {
            const content = document.getElementById('cache-log-content');
            const icon = document.getElementById('cache-log-toggle-icon');
            if (content.style.display === 'none') {
                content.style.display = 'block';
                icon.className = 'fas fa-chevron-up';
            } else {
                content.style.display = 'none';
                icon.className = 'fas fa-chevron-down';
            }
        }
        // Atualizar timers de leil√£o em tempo real
        function atualizarTimersLeilao() {
            const timers = document.querySelectorAll(".card-timer[data-auction-end]");
            const now = Math.floor(Date.now() / 1000);
            timers.forEach(timer => {
                const auctionEnd = parseInt(timer.getAttribute("data-auction-end"));
                const tempoRestante = auctionEnd - now;
                if (tempoRestante > 0) {
                    const horas = Math.floor(tempoRestante / 3600);
                    const minutos = Math.floor((tempoRestante % 3600) / 60);
                    const segundos = tempoRestante % 60;
                    const texto = `${String(horas).padStart(2, "0")}:${String(minutos).padStart(2, "0")}:${String(segundos).padStart(2, "0")}`;
                    timer.innerHTML = `<i class="fas fa-clock"></i> ${texto}`;
                    timer.classList.remove("timer-expired");
                } else {
                    timer.innerHTML = `<i class="fas fa-clock"></i> VERIFICANDO...`;
                    timer.classList.add("timer-expired");
                    // Verificar se conta ainda est√° ativa
                    const card = timer.closest(".nft-card");
                    if (card) {
                        const nftId = card.querySelector("[data-nft-id]")?.getAttribute("data-nft-id");
                        if (nftId) verificarContaAinda(nftId, card);
                    }
                }
            });
        }
        
        // Verificar se conta ainda est√° ativa quando timer zerar
        async function verificarContaAinda(nftId, card) {
            try {
                const res = await fetch(`/api/verificar-conta-ativa/${nftId}`);
                const data = await res.json();
                const timer = card.querySelector(".card-timer");
                if (data.ativa) {
                    // Teve novo lance, atualizar timer
                    timer.setAttribute("data-auction-end", data.conta.auctionEndTime);
                    timer.classList.remove("timer-expired");
                } else {
                    // Conta n√£o est√° mais ativa - remover o card com anima√ß√£o
                    timer.innerHTML = `<i class="fas fa-check"></i> FINALIZADO`;
                    card.style.transition = 'opacity 0.5s, transform 0.5s';
                    card.style.opacity = '0';
                    card.style.transform = 'scale(0.9)';
                    setTimeout(() => {
                        card.remove();
                        // Atualizar contador
                        const contador = document.querySelector('.resultados-info');
                        if (contador) {
                            const match = contador.textContent.match(/\d+/);
                            if (match) {
                                const novoTotal = Math.max(0, parseInt(match[0]) - 1);
                                contador.innerHTML = contador.innerHTML.replace(/\d+/, novoTotal);
                            }
                        }
                        mostrarNotificacao('Leil√£o finalizado - conta removida', 'info');
                    }, 500);
                }
            } catch (e) {
                console.error("Erro ao verificar conta:", e);
            }
        }
        
        // Iniciar atualiza√ß√£o a cada segundo
        setInterval(atualizarTimersLeilao, 1000);

    </script>

<!-- ===== MODAL DE LOGIN ===== -->
<div id="modal-login" class="modal-overlay" style="display: none;">
    <div class="modal-container modal-auth">
        <div class="modal-header">
            <h2><i class="fas fa-sign-in-alt"></i> Login</h2>
            <button class="modal-close" onclick="fecharModal('modal-login')">&times;</button>
        </div>
        <div class="modal-body">
            <form id="form-login" onsubmit="return submitLogin(event)">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                
                <div class="form-group-modal">
                    <label><i class="fas fa-user"></i> Email ou Usu√°rio</label>
                    <input type="text" id="login-input" name="login" placeholder="seu@email.com ou seu_nick" required>
                </div>
                
                <div class="form-group-modal">
                    <label><i class="fas fa-lock"></i> Senha</label>
                    <input type="password" id="login-password" name="password" placeholder="Sua senha" required>
                </div>
                
                <div class="form-group-modal checkbox-inline">
                    <input type="checkbox" id="login-remember" name="remember_me">
                    <label for="login-remember">Lembrar-me neste dispositivo</label>
                </div>
                
                <div id="login-error" class="modal-error" style="display: none;"></div>
                
                <button type="submit" class="btn-modal-submit">
                    <i class="fas fa-sign-in-alt"></i> Entrar
                </button>
            </form>
            
            <div class="modal-footer-links">
                <p>N√£o tem conta? <a href="#" onclick="trocarModal('modal-login', 'modal-register')">Registre-se</a></p>
            </div>
        </div>
    </div>
</div>

<!-- ===== MODAL DE CADASTRO ===== -->
<div id="modal-register" class="modal-overlay" style="display: none;">
    <div class="modal-container modal-auth">
        <div class="modal-header">
            <h2><i class="fas fa-user-plus"></i> Criar Conta</h2>
            <button class="modal-close" onclick="fecharModal('modal-register')">&times;</button>
        </div>
        <div class="modal-body">
            <form id="form-register" onsubmit="return submitRegister(event)">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                
                <div class="form-group-modal">
                    <label><i class="fas fa-user"></i> Nome de Usu√°rio</label>
                    <input type="text" id="register-username" name="username" placeholder="Seu nome de usu√°rio" required minlength="3">
                </div>
                
                <div class="form-group-modal">
                    <label><i class="fas fa-envelope"></i> Email</label>
                    <input type="email" id="register-email" name="email" placeholder="seu@email.com" required>
                </div>
                
                <div class="form-group-modal">
                    <label><i class="fas fa-lock"></i> Senha</label>
                    <input type="password" id="register-password" name="password" placeholder="M√≠nimo 6 caracteres" required minlength="6">
                </div>
                
                <div class="form-group-modal">
                    <label><i class="fas fa-lock"></i> Confirmar Senha</label>
                    <input type="password" id="register-password2" name="password2" placeholder="Repita a senha" required>
                </div>
                
                <div id="register-error" class="modal-error" style="display: none;"></div>
                
                <button type="submit" class="btn-modal-submit btn-register">
                    <i class="fas fa-user-plus"></i> Criar Conta
                </button>
            </form>
            
            <div class="modal-footer-links">
                <p>J√° tem conta? <a href="#" onclick="trocarModal('modal-register', 'modal-login')">Fa√ßa login</a></p>
            </div>
        </div>
    </div>
</div>
</body>
</html>